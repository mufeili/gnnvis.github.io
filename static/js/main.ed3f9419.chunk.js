(this.webpackJsonpgnnvis=this.webpackJsonpgnnvis||[]).push([[0],{109:function(e,t,n){},127:function(e,t,n){e.exports=n.p+"static/media/logo2.4b8ec5cf.png"},143:function(e,t,n){e.exports=n(264)},148:function(e,t,n){},149:function(e,t,n){},151:function(e,t,n){},152:function(e,t,n){},210:function(e,t,n){},211:function(e,t,n){},212:function(e,t,n){},214:function(e,t,n){},235:function(e,t,n){},236:function(e,t,n){var r=n(21);!function(){function e(e){return e.length?r.keys(e[0]).sort():[]}function t(){r.event.stopPropagation(),r.event.preventDefault()}function n(e){return e.name}function a(e){return e[0].categories.reduce((function(e,t){return e+t.count}),0)}r.parsets=function(){var o,i,f,p,g=r.dispatch("sortDimensions","sortCategories","ribbonClick","categoryClick"),v=e,_=String,m=h,y=d,x=20,b=1,w=500;function C(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function E(e){return"function"===typeof e?e:function(){return e}}function S(e){e.each((function(e,s){var h,d,_,C,E=r.select(this),S=r.scaleOrdinal(),M=!1,D=v.call(this,e,s),G=[],T={children:{},count:0};if(r.select(window).on("mousemove.parsets."+ ++c,Y),null==p&&(p=b),E.selectAll(".ribbon, .ribbon-mouse").data(["ribbon","ribbon-mouse"],String).enter().append("g").attr("class",String),function(){var s=E.selectAll("g.dimension"),c={};s.each((function(e){c[e.name]=e})),D.forEach((function(e){c.hasOwnProperty(e)||(c[e]={name:e,categories:[]}),G.push(c[e])})),G.sort(A),E.select(".ribbon").selectAll("path").each((function(e){for(var t=e.path.split("\0"),n=T,r=t.length-1,a=0;a<r;a++){var o=t[a];n=n.children.hasOwnProperty(o)?n.children[o]:n.children[o]={children:{},count:0}}n.children[e.name]=e})),T=l(T,e,G.map(n),o),c=G.map((function(e){var t={};return e.categories.forEach((function(e){t[e.name]=e})),t})),function e(t,n){if(t.children){var r=G[n],a=c[n];for(var o in t.children)a.hasOwnProperty(o)||r.categories.push(a[o]={name:o}),e(t.children[o],n+1)}}(T,0),G.forEach((function(e,t){G[t].categories=e.categories.sort((function(e,t){return e.name<t.name?-1:1}))})),S.domain([]).range(r.range(G[0].categories.length)),h=P(T,G,S),d=a(G),G.forEach((function(e){e.count=d}));var p=(s=s.data(G,n)).enter().append("g").attr("class","dimension").attr("transform",(function(e){return"translate(0,"+e.y+")"})).on("mousedown.parsets",t);s.merge(p).each((function(e){e.y0=e.y,e.categories.forEach((function(e){e.x0=e.x}))})),p.append("rect").attr("width",i).attr("y",-45).attr("height",45);var v=p.append("text").attr("class","dimension").attr("transform","translate(0,-25)");v.append("tspan").attr("class","name").text(k),v.append("tspan").attr("class","sort alpha").attr("dx","2em").text("alpha \xbb").on("mousedown.parsets",t),v.append("tspan").attr("class","sort size").attr("dx","2em").text("size \xbb").on("mousedown.parsets",t),s.merge(p).call(r.drag().on("start",(function(e){M=!0,e.y0=e.y})).on("drag",(function(t){t.y0=t.y=r.event.y;for(var i=1;i<G.length;i++)if(f*G[i].y<f*G[i-1].y){G.sort(A),D=G.map(n),S.domain([]).range(r.range(G[0].categories.length)),h=P(T=l({children:{},count:0},e,D,o),G,S),d=a(G),E.selectAll(".ribbon, .ribbon-mouse").selectAll("path").remove(),X(s.merge(p)),H(),s.merge(p).transition().duration(w).attr("transform",u).tween("ribbon",W),g.call("sortDimensions");break}r.select(this).attr("transform","translate(0,"+t.y+")").transition(),_.merge(C).filter((function(e){return e.source.dimension===t||e.target.dimension===t})).attr("d",O)})).on("end",(function(e){M=!1,Y();var t=(f-45-2)/(G.length-1);G.forEach((function(e,n){e.y=45+n*t})),I(r.select(this)).attr("transform","translate(0,"+e.y+")").tween("ribbon",W)}))),s.merge(p).select("text").select("tspan.sort.alpha").on("click.parsets",V("alpha",(function(e,t){return e.name<t.name?1:-1}),s)),s.merge(p).select("text").select("tspan.sort.size").on("click.parsets",V("size",(function(e,t){return e.count-t.count}),s)),s.merge(p).transition().duration(w).attr("transform",(function(e){return"translate(0,"+e.y+")"})).tween("ribbon",W),s.exit().remove(),X(s.merge(p)),H()}(),b!=p){var R=r.transition(E);R.tween?R.tween("ribbon",F):F()(1)}function F(){var e=r.interpolateNumber(p,b);return function(t){p=e(t),_.merge(C).attr("d",O)}}function V(e,t,n){return function(a){var o=this.__direction=-(this.__direction||1);r.select(this).text(o>0?e+" \xbb":"\xab "+e),a.categories.sort((function(){return o*t.apply(this,arguments)})),h=P(T,G,S),H(),X(n.merge(n.enter())),g.call("sortCategories")}}function H(){_=E.select(".ribbon").selectAll("path").data(h,(function(e){return e.path})),(C=_.enter().append("path").each((function(e){e.source.x0=e.source.x,e.target.x0=e.target.x}))).merge(_).attr("class",(function(e){return"category-"+e.major})).attr("d",O),C.merge(_).sort((function(e,t){return t.count-e.count})),_.exit().remove();var e=E.select(".ribbon-mouse").selectAll("path").data(h,(function(e){return e.path})),t=e.enter().append("path");t.merge(e).on("mousemove.parsets",(function(e){J(_.merge(C)).classed("active",!1),M||(z(e=e.node,!0),L(m.call(this,e)),r.event.stopPropagation())})).on("click.parsets",(function(e){_.merge(C).classed("active",!1),_.merge(C).classed("selected",!1),M||(B(e=e.node,!0),g.call("ribbonClick",this,{data:e,selected:!0}),r.event.stopPropagation())})),e.merge(t).sort((function(e,t){return t.count-e.count})).attr("d",j),e.exit().remove()}function U(e){var t=[e],n=_.merge(C).filter((function(n){var r,a;return n.source.node===e&&t.push(r=n.source),n.target.node===e&&t.push(a=n.target),r||a})),a=t.map((function(e){return r.interpolateNumber(e.x0,e.x)})),o=t.length;return function(e){for(var r=0;r<o;r++)t[r].x0=a[r](e);n.attr("d",O)}}function W(e){var t=_.merge(C).filter((function(t){return t.source.dimension.name==e.name||t.target.dimension.name==e.name})),n=r.interpolateNumber(e.y0,e.y);return function(r){e.y0=n(r),t.attr("d",O)}}function z(e,t){if(!M){var n=[];if(function e(t){for(var r in n.push(t),t.children)e(t.children[r])}(e),n.shift(),t)for(;e;)n.push(e),e=e.parent;_.merge(C).filter((function(e){var t=n.indexOf(e.node)>=0;return t&&this.parentNode.appendChild(this),t})).classed("active",!0)}}function B(e,t){if(!M){var n=[];if(function e(t){for(var r in n.push(t),t.children)e(t.children[r])}(e),n.shift(),t)for(;e;)n.push(e),e=e.parent;_.merge(C).filter((function(e){var t=n.indexOf(e.node)>=0;return t&&this.parentNode.appendChild(this),t})).classed("selected",!0).classed("active",!0)}}function J(e){return e.filter((function(e){return!r.select(this).classed("selected")}))}function Y(){M||(J(_.merge(C)).classed("active",!1),N.style("display","none"))}function X(e){var n=e.selectAll("g.category").data((function(e){return e.categories}),(function(e){return e.dimension.name+"_"+e.name})),a=n.enter().append("g").attr("class","category");a.merge(n).attr("transform",(function(e){return"translate("+e.x+")"})),n.merge(a).on("mousemove.parsets",(function(e){J(_.merge(C)).classed("active",!1),M||(e.nodes.forEach((function(e){z(e)})),L(y.call(this,e)),r.event.stopPropagation())})).on("mouseout.parsets",Y).on("mousedown.parsets",t).call(r.drag().on("start",(function(e){M=!0,e.x0=e.x})).on("drag",(function(t){t.x=r.event.x;for(var n=t.dimension.categories,a=0,o=n[0];++a<n.length;)if(o.x+o.dx/2>(o=n[a]).x+o.dx/2){n.sort((function(e,t){return e.x+e.dx/2-t.x-t.dx/2})),h=P(T,G,S),H(),X(e),z(t.node),g.call("sortCategories");break}var s=0,c=x/(n.length-1);n.forEach((function(e){t===e&&(e.x0=r.event.x),e.x=s,s+=e.count/d*(i-x)+c})),r.select(this).attr("transform",(function(e){return"translate("+e.x0+")"})).transition(),_.merge(C).filter((function(e){return e.source.node===t||e.target.node===t})).attr("d",O)})).on("end",(function(e){M=!1,Y(),H(),I(r.select(this)).attr("transform","translate("+e.x+")").tween("ribbon",U)}))).on("click.parsets",(function(e){M||(_.merge(C).classed("active",!1),_.merge(C).classed("selected",!1),e.nodes.forEach((function(e){B(e)})),g.call("categoryClick",this,{data:e,selected:!0}),r.event.stopPropagation())})),n.merge(a).transition().duration(w).attr("transform",(function(e){return"translate("+e.x+")"})).tween("ribbon",U),a.append("rect").attr("width",(function(e){return e.dx})).attr("y",-20).attr("height",20),a.append("line").style("stroke-width",2),a.append("text").attr("dy","-.3em"),n.merge(a).select("rect").attr("width",(function(e){return e.dx})).attr("class",(function(e){return"category-"+(e.dimension===G[0]?S(e.name):"background")})),n.merge(a).select("line").attr("x2",(function(e){return e.dx})),n.merge(a).select("text").text(function(e,t){return function(n,r){var a=this.textContent=e(n,r),o=t(n,r);if(this.getComputedTextLength()<o)return a;this.textContent="\u2026"+a;for(var i=0,s=a.length+1;i<s;){var c=i+s>>1;this.getSubStringLength(0,c)<o?i=c+1:s=c}return i>1?a.substr(0,i-2)+"\u2026":""}}((function(e){return e.name}),(function(e){return e.dx})))}}))}r.rebind=function(e,t){for(var n,r=1,a=arguments.length;++r<a;)e[n=arguments[r]]=C(e,t,t[n]);return e},S.dimensionFormat=function(e){return arguments.length?(_=e,S):_},S.dimensions=function(e){return arguments.length?(v=E(e),S):v},S.value=function(e){return arguments.length?(o=E(e),S):o},S.width=function(e){return arguments.length?(i=+e,S):i},S.height=function(e){return arguments.length?(f=+e,S):f},S.spacing=function(e){return arguments.length?(x=+e,S):x},S.tension=function(e){return arguments.length?(b=+e,S):b},S.duration=function(e){return arguments.length?(w=+e,S):w},S.tooltip=function(e){return arguments.length?(m=null==e?h:e,S):N},S.categoryTooltip=function(e){return arguments.length?(y=null==e?d:e,S):y};var M=r.select("body"),N=M.append("div").style("display","none").attr("class","parsets tooltip");return r.rebind(S,g,"on").value(1).width(960).height(600);function k(e,t){return _.call(this,e.name,t)}function L(e){var t=r.mouse(M.node());N.style("display",null).style("left",t[0]+30+"px").style("top",t[1]-20+"px").html(e)}function I(e){return w?e.transition().duration(w).ease(s):e}function P(e,t,n){var r=[],a=t.length,o=(f-45-2)/(a-1);t.forEach((function(e,t){e.categories.forEach((function(t){t.dimension=e,t.count=0,t.nodes=[]})),e.y=45+t*o}));var s=function e(n,r){if(!n.children)return n.count;var a=t[r],o=0;return a.categories.forEach((function(t){var a=n.children[t.name];if(a){t.nodes.push(a);var i=e(a,r+1);t.count+=i,o+=i}})),o}(e,0);return t.forEach((function(e){e.categories=e.categories.filter((function(e){return e.count}));var t=0,n=x/(e.categories.length-1);e.categories.forEach((function(e){e.x=t,e.dx=e.count/s*(i-x),e.in={dx:0},e.out={dx:0},t+=e.dx+n}))})),t[0].categories.forEach((function(a){var o=a.name;e.children.hasOwnProperty(o)&&function e(n,a,o,c){var l=a.node,u=t[o];u.categories.forEach((function(h){var d=h.name;if(l.children.hasOwnProperty(d)){var f=l.children[d];f.path=a.path+"\0"+d;var p=f.target||{node:h,dimension:u};p.x=h.in.dx,p.dx=f.count/s*(i-x),h.in.dx+=p.dx;var g=f.source||{node:n,dimension:t[o-1]};g.x=n.out.dx,g.dx=p.dx,n.out.dx+=g.dx,f.node=f,f.source=g,f.target=p,f.major=c,r.push(f),o+1<t.length&&e(h,f,o+1,c)}}))}(a,{node:e.children[o],path:o},1,n(o))})),r}function O(e){var t=e.source,n=e.target;return D(t.node.x0+t.x0,t.dimension.y0,t.dx,n.node.x0+n.x0,n.dimension.y0,n.dx,p)}function j(e){var t=e.source,n=e.target;return D(t.node.x+t.x,t.dimension.y,t.dx,n.node.x+n.x,n.dimension.y,n.dx,b)}function D(e,t,n,r,a,o,i){var s,c;return(1===i?["M",[e,t],"L",[r,a],"h",o,"L",[e+n,t],"Z"]:["M",[e,t],"C",[e,s=i*t+(1-i)*a]," ",[r,c=i*a+(1-i)*t]," ",[r,a],"h",o,"C",[r+o,c]," ",[e+n,s]," ",[e+n,t],"Z"]).join("")}function A(e,t){return(e=f*e.y)<(t=f*t.y)?-1:e>t?1:e>=t?0:e<=e?-1:t<=t?1:NaN}},r.parsets.tree=l;var o=r.format(".2%"),i=r.format("d"),s=r.easeElastic,c=0;function l(e,t,n,r){!function e(t){if(t.count=0,t.children)for(var n in t.children)e(t.children[n])}(e);for(var a=t.length,o=n.length,i=0;i<a;i++){for(var s=t[i],c=+r(s,i),l=e,u=0;u<o;u++){var h=n[u],d=s[h],f=l.children;l.count+=c,l=f.hasOwnProperty(d)?f[d]:f[d]={children:u===o-1?null:{},count:0,parent:l,dimension:h,name:d}}l.count+=c}return e}function u(e){return"translate(0,"+e.y+")"}function h(e){for(var t=e.count,n=[];e.parent;)e.name&&n.unshift(e.name),e=e.parent;return n.join(" \u2192 ")+"<br>"+i(t)+" ("+o(t/e.count)+")"}function d(e){return e.name+"<br>"+i(e.count)+" ("+o(e.count/e.dimension.count)+")"}}()},237:function(e,t,n){},238:function(e,t,n){},239:function(e,t){e.exports=new function(){var e=this;function t(n,r,a){this.rows=function(){return r},this.cols=function(){return a},this.isQuadratic=function(){return r===a},t.prototype.noNaNs=function(){e.noNaNs(n)},this.someRows=function(e){for(var t=0,o=0;o<r;o+=1){if(e(n.subarray(t,t+a),o))return!0;t+=a}return!1},this.everyRows=function(e){return!this.someRows((function(t,n){return!e(t,n)}))},this.rowsIter=function(e){for(var t=0,o=0;o<r;o+=1)e(n.subarray(t,t+a),o),t+=a},this.rowIter=function(e,t){for(var r=e*a,o=0;o<a;o+=1)t(n[r],e,o),r+=1},this.colIter=function(e,t){for(var o=e,i=0;i<r;i+=1)t(n[o],i,e),o+=a},this.getUnsafe=function(e){return n[e]},this.createArray=function(e,t){var r=e*t;return n.byteLength>24?new Float64Array(r):new Float32Array(r)}}this.DEBUG=!1,this.noNaNs=function(e){for(var t=0;t<e.length;t+=1)if(Number.isNaN(e[t]))throw new Error("NaN in array")},this.noZeros=function(e){for(var t=0;t<e.length;t+=1)if(Number.isNaN(e[t])||0===e[t])throw new Error(0===e[t]?"0 in array":"NaN in array")},this.onlyPositive=function(e){for(var t=0;t<e.length;t+=1)if(Number.isNaN(e[t])||!(e[t]>0))throw new Error(e[t]>0?"NaN in array":e[t]+" in array")},this.CALL_ASYNC=function(e){setTimeout(e,0)},this.getCallDirect=function(){var e=0;return function(t){if(e>20)throw{__continuation:t};if(e)e+=1,t();else for(var n=t;n;){try{e+=1,n(),n=null}catch(r){if(!r.__continuation)throw r;n=r.__continuation}e=0}}},this.pca=function(t){var n;return e.pcaAsync(t,(function(e){n=e}),e.getCallDirect()),n},this.pcaAsync=function(n,r,a){var o=arguments.length>2?a:e.CALL_ASYNC,i=n.colCenter(),s=(i.rows(),i.cols());i.powerIterAsync((function(n){e.removeComponent(i,n).powerIterAsync((function(e){for(var a=i.createArray(s,2),o=0;o<s;o+=1)a[2*o+0]=n[o],a[2*o+1]=e[o];r(new t(a,s,2))}),o)}),o)},this.GRAM_SCHMIDT_EPS=1e-12,this.removeComponent=function(n,r){var a=n.rows(),o=n.cols();function i(t,r,a,o,i){for(var s=n.createArray(1,i),c=0,l=0,u=0;u<i;u+=1)c+=a[o+u]*t[r+u],l+=a[o+u]*a[o+u];if(Math.abs(c)<e.GRAM_SCHMIDT_EPS||Math.abs(l)<e.GRAM_SCHMIDT_EPS||!Number.isFinite(l)||!Number.isFinite(c))for(u=0;u<i;u+=1)s[u]=0;else for(u=0;u<i;u+=1)s[u]=c/l*a[o+u];return s}r.length===o||console.warn("incompatible size",r.length,o);for(var s=n.createArray(a,o),c=0,l=0;l<a;l+=1)n.rowIter(l,(function(e){s[c]=e,c+=1}));for(l=0;l<a;l+=1){var u=l*o;e.normalizeVec(s,u,u+o);for(var h=l+1;h<a;h+=1)for(var d=i(s,c=h*o,s,u,o),f=0;f<o;f+=1)s[c+f]-=d[f]}return new t(s,a,o)},this.pcaPositions=function(t){var n=e.pca(t);return t.mul(n)},this.landmarkMDS=function(t,n){var r;return e.landmarkMDSAsync(t,n,(function(e){r=e}),e.getCallDirect()),r},this.landmarkMDSAsync=function(n,r,a,o){function i(n){e.DEBUG&&n.noNaNs();for(var r=n.rows(),a=n.cols(),o=new Uint32Array(r),i=0;i<r;i+=1)n.rowIter(i,(function(e,t,n){e||(o[t]=n)}));e.DEBUG&&e.noNaNs(o);var s=n.createArray(r,r),c=0;for(i=0;i<r;i+=1)for(var l=i*a,u=0;u<a;u+=1)s[c]=n.getUnsafe(l+o[u]),c+=1;return e.DEBUG&&e.noNaNs(s),new t(s,r,r)}function s(n,r,a,o){var i=n.rows(),s=n.cols(),c=n.squareElements();e.DEBUG&&c.noNaNs();for(var l=n.createArray(1,s),u=0;u<s;u+=1)c.colIter(u,(function(e){l[u]+=e})),l[u]/=i;e.DEBUG&&e.noNaNs(l),e.DEBUG&&a.noNaNs(),e.DEBUG&&e.noZeros(o);for(var h=a.createArray(a.rows(),a.cols()),d=0,f=0;f<a.rows();f+=1){var p=Math.sqrt(Math.abs(o[f]));a.rowIter(f,(function(e){h[d]=e/p,d+=1}))}e.DEBUG&&e.noNaNs(h);var g=n.createArray(s,r);d=0;for(var v=0;v<s;v+=1)for(var _=l[v],m=0,y=0;y<r;y+=1){var x=0;c.colIter(v,(function(e){x-=.5*(e-_)*h[m],m+=1})),g[d]=x,d+=1}return e.DEBUG&&e.noNaNs(g),new t(g,s,r)}var c=arguments.length>3?o:e.CALL_ASYNC,l=i(n),u=n.createArray(1,r);l.squareElements().doubleCenter().scale(-.5).eigenAsync(u,(function(e){a(s(n,r,e,u))}),c)},this.normalizeVec=function(e,t,n){for(var r=arguments.length>1?t:0,a=arguments.length>2?n:e.length,o=0,i=r;i<a;i+=1)o+=e[i]*e[i];if(!((o=Math.sqrt(o))<1e-30)&&Number.isFinite(o))for(i=r;i<a;i+=1)e[i]/=o},this.lengthSq=function(e,t,n){for(var r=arguments.length>1?t:0,a=arguments.length>2?n:e.length,o=0,i=r;i<a;i+=1)o+=e[i]*e[i];return o},this.prod=function(e,t,n,r,a){for(var o=0,i=t,s=r,c=0;c<a;c+=1)o+=e[i]*n[s],i+=1,s+=1;return o},this.xcopy=function(e,t,n,r,a){for(var o=t,i=r,s=0;s<a;s+=1)n[i]=e[o],o+=1,i+=1},this.convertToMatrix=function(e,n){var r=e.length;if(!r)return console.warn("invalid dimension (rows)",r),null;var a=e[0].length;if(!a)return console.warn("invalid dimension (cols)",a),null;for(var o=r*a,i=n?new Float32Array(o):new Float64Array(o),s=0,c=0;c<r;c+=1){var l=e[c];if(l.length!==a)return console.warn("invalid dimension in row "+c,l.length,a),null;for(var u=0;u<a;u+=1)i[s]=l[u],s+=1}return new t(i,r,a)},this.eye=function(e,n,r){var a=arguments.length<2?e:n,o=e*a;if(e<=0||a<=0)return console.warn("invalid dimensions",e,a),null;for(var i=r?new Float32Array(o):new Float64Array(o),s=0,c=0;c<Math.min(e,a);c+=1)i[s]=1,s+=a+1;return new t(i,e,a)},this.pivotRandom=function(e,n){if(!e.isQuadratic())return console.warn("quadratic matrix needed",e.rows(),e.cols()),null;if(n<e.rows())return console.warn("requested more pivots than elements",n,e.rows(),e.cols()),null;for(var r=e.createArray(n,e.cols()),a={},o=0,i=0;i<n;i+=1){var s=0;do{s=Math.random()*e.cols()}while(a[s]);a[s]=!0;for(var c=0;c<e.cols();c+=1)r[o]=e.distance(s,c),o+=1}return new t(r,n,e.cols())},t.prototype.toString=function(){for(var e="",t=0;t<this.rows();t+=1)this.rowIter(t,(function(t,n){e+=" "+t})),e+="\n";return e},t.prototype.iter=function(e,n,r,a){t.iter(this,e,n,r,a)},t.prototype.mul=function(e){return t.mul(this,e)},t.prototype.add=function(e){return t.add(this,e)},t.prototype.neg=function(){for(var e=this.createArray(this.rows(),this.cols()),n=0;n<e.length;n+=1)e[n]=-this.getUnsafe(n);return new t(e,this.rows(),this.cols())},t.prototype.scale=function(e){for(var n=this.createArray(this.rows(),this.cols()),r=0;r<n.length;r+=1)n[r]=e*this.getUnsafe(r);return new t(n,this.rows(),this.cols())},t.prototype.squareElements=function(){for(var e=this.createArray(this.rows(),this.cols()),n=0;n<e.length;n+=1)e[n]=this.getUnsafe(n)*this.getUnsafe(n);return new t(e,this.rows(),this.cols())},t.prototype.colCenter=function(){for(var e=this.rows(),n=this.cols(),r=this.createArray(e,n),a=0;a<n;a+=1){var o=0;this.colIter(a,(function(e){o+=e})),o/=e;var i=a;this.colIter(a,(function(e){r[i]=e-o,i+=n}))}return new t(r,e,n)},t.prototype.rowCenter=function(){for(var e=this.rows(),n=this.cols(),r=this.createArray(e,n),a=0,o=0;o<e;o+=1){var i=0;this.rowIter(o,(function(e){i+=e})),i/=n,this.rowIter(o,(function(e){r[a]=e-i,a+=1}))}return new t(r,e,n)},t.prototype.doubleCenter=function(){for(var e=this.rows(),n=this.cols(),r=this.createArray(e,n),a=0;a<e;a+=1){var o=0;this.rowIter(a,(function(e){o+=e})),o/=n;var i=a*n;this.rowIter(a,(function(e){r[i]=e-o,i+=1}))}for(var s=0;s<n;s+=1){for(o=0,i=s,a=0;a<e;a+=1)o+=r[i],i+=n;o/=e,i=s;for(a=0;a<e;a+=1)r[i]-=o,i+=n}return new t(r,e,n)},t.prototype.distance=function(e,t){for(var n=0,r=e,a=t,o=0;o<this.rows();o+=1){var i=this.getUnsafe(r)-this.getUnsafe(a);n+=i*i,r+=this.cols(),a+=this.cols()}return Math.sqrt(n)},this.EIGEN_EPS=1e-7,this.EIGEN_ITER=1e4,this.EIGEN_ITER_ASYNC=200,t.prototype.eigen=function(t){var n;return this.eigenAsync(t,(function(e){n=e}),e.getCallDirect()),n},t.prototype.eigenAsync=function(n,r,a){for(var o=arguments.length>2?a:e.CALL_ASYNC,i=this,s=n.length,c=i.rows(),l=i.cols(),u=i.createArray(c,l),h=0,d=0;d<c;d+=1)i.rowIter(d,(function(e){u[h]=e,h+=1}));var f=i.createArray(s,c),p=-c,g=0,v=(d=0,0);function _(){for(var t=0;t<e.EIGEN_ITER_ASYNC;t+=1){if(!(Math.abs(1-d)>e.EIGEN_EPS&&v<e.EIGEN_ITER))return g+=1,void m();var r=i.createArray(1,c);h=0;for(var a=0;a<c;a+=1)for(var s=0;s<l;s+=1)r[a]+=u[h]*f[p+s],h+=1;n[g]=e.prod(f,p,r,0,c),e.normalizeVec(r),d=Math.abs(e.prod(f,p,r,0,c)),e.xcopy(r,0,f,p,c),v+=1}o(_)}function m(){if(g<s){if(g>0){h=0;for(var a=0;a<c;a+=1)for(var i=0;i<l;i+=1)u[h]-=n[g-1]*f[p+a]*f[p+i],h+=1}h=p+=c;for(var m=0;m<c;m+=1)f[h]=Math.random(),h+=1;e.normalizeVec(f,p,p+c),d=0,v=0,o(_)}else r(new t(f,s,c))}m()},t.prototype.powerIter=function(){var t;return this.powerIterAsync((function(e){t=e}),e.getCallDirect()),t},t.prototype.powerIterAsync=function(t,n){for(var r=arguments.length>1?n:e.CALL_ASYNC,a=this,o=a.rows(),i=a.cols(),s=a.createArray(1,i),c=0;c<i;c+=1)s[c]=Math.random();var l=Number.POSITIVE_INFINITY,u=!1,h=0;function d(){for(var n=0;n<e.EIGEN_ITER_ASYNC;n+=1){if(h>=e.EIGEN_ITER||u)return void t(s);for(var c=a.createArray(1,i),f=0;f<o;f+=1){var p=0;a.rowIter(f,(function(e,t,n){p+=e*s[n]})),a.rowIter(f,(function(e,t,n){c[n]+=p*e}))}var g=e.lengthSq(c);Math.abs(l-g)<e.EIGEN_EPS&&(u=!0),l=g,e.normalizeVec(c),s=c,h+=1}r(d)}d()},t.iter=function(e,t,n,r,a){if(e.cols()===t.rows())for(var o=n*e.cols(),i=r,s=0;s<e.cols();s+=1)a(e.getUnsafe(o),t.getUnsafe(i),n,s,r),o+=1,i+=t.cols();else console.warn("incompatible dimensions",e.rows()+"x"+e.cols(),t.rows()+"x"+t.cols())},t.mul=function(e,n){if(e.cols()!==n.rows())return console.warn("incompatible dimensions",e.rows()+"x"+e.cols(),n.rows()+"x"+n.cols()),null;for(var r=e.createArray(e.rows(),n.cols()),a=0;a<e.rows();a+=1)e.rowIter(a,(function(e,t,o){var i=a*n.cols();n.rowIter(o,(function(t,n,a){r[i]+=e*t,i+=1}))}));return new t(r,e.rows(),n.cols())},t.add=function(e,n){if(e.rows()!==n.rows()||e.cols()!==n.cols())return console.warn("incompatible dimensions",e.rows()+"x"+e.cols(),n.rows()+"x"+n.cols()),null;for(var r=e.createArray(e.rows(),e.cols()),a=0;a<r.length;a+=1)r[a]=e.getUnsafe(a)+n.getUnsafe(a);return new t(r,e.rows(),e.cols())}}},240:function(e,t,n){"use strict";n.r(t);var r=n(21),a=n(137),o=n.n(a);t.default=function(){var e,t=[],n=75,a=!0,i=!1,s=!0,c={start:function(){},draw:function(){},end:function(){}};function l(l){var u,h,d,f,p=l.append("g").attr("class","lasso"),g=p.append("path").attr("class","drawn"),v=p.append("path").attr("class","loop_close"),_=p.append("circle").attr("class","origin"),m=r.drag().on("start",(function(){f=[],u="",g.attr("d",null),v.attr("d",null),t.nodes().forEach((function(e){e.__lasso.possible=!1,e.__lasso.selected=!1,e.__lasso.hoverSelect=!1,e.__lasso.loopSelect=!1;var t=e.getBoundingClientRect();e.__lasso.lassoPoint=[Math.round(t.left+t.width/2),Math.round(t.top+t.height/2)]})),s&&t.on("mouseover.lasso",(function(){this.__lasso.hoverSelect=!0}));c.start()})).on("drag",(function(){var e,s;"touchmove"===r.event.sourceEvent.type?(e=r.event.sourceEvent.touches[0].clientX,s=r.event.sourceEvent.touches[0].clientY):(e=r.event.sourceEvent.clientX,s=r.event.sourceEvent.clientY);var l=r.mouse(this)[0],p=r.mouse(this)[1];""===u?(u=u+"M "+l+" "+p,h=[e,s],d=[l,p],_.attr("cx",l).attr("cy",p).attr("r",7).attr("display",null)):u=u+" L "+l+" "+p;f.push([e,s]);var m=Math.sqrt(Math.pow(e-h[0],2)+Math.pow(s-h[1],2)),y="M "+l+" "+p+" L "+d[0]+" "+d[1];g.attr("d",u),v.attr("d",y),(i=m<=n)&&a?v.attr("display",null):v.attr("display","none");t.nodes().forEach((function(e){e.__lasso.loopSelect=!(!i||!a)&&o()(f,e.__lasso.lassoPoint)<1,e.__lasso.possible=e.__lasso.hoverSelect||e.__lasso.loopSelect})),c.draw()})).on("end",(function(){t.on("mouseover.lasso",null),t.nodes().forEach((function(e){e.__lasso.selected=e.__lasso.possible,e.__lasso.possible=!1})),g.attr("d",null),v.attr("d",null),_.attr("display","none"),c.end()}));e.call(m)}return l.items=function(e){if(!arguments.length)return t;var n=(t=e).nodes();return n.forEach((function(e){e.__lasso={possible:!1,selected:!1}})),l},l.possibleItems=function(){return t.filter((function(){return this.__lasso.possible}))},l.selectedItems=function(){return t.filter((function(){return this.__lasso.selected}))},l.notPossibleItems=function(){return t.filter((function(){return!this.__lasso.possible}))},l.notSelectedItems=function(){return t.filter((function(){return!this.__lasso.selected}))},l.closePathDistance=function(e){return arguments.length?(n=e,l):n},l.closePathSelect=function(e){return arguments.length?(a=!0===e,l):a},l.isPathClosed=function(e){return arguments.length?(i=!0===e,l):i},l.hoverSelect=function(e){return arguments.length?(s=!0===e,l):s},l.on=function(e,t){if(!arguments.length)return c;if(1===arguments.length)return c[e];var n=["start","draw","end"];return n.indexOf(e)>-1&&(c[e]=t),l},l.targetArea=function(t){return arguments.length?(e=t,l):e},l}},246:function(e,t,n){var r=r||{REVISION:"ALPHA"};!function(e){"use strict";var t=function(e,t){if(!e)throw t||"Assertion failed"},n=function(e,t,n){return e.hasOwnProperty(t)?e[t]:n},r=!1,a=0,o=function(e,t){return e+function e(){if(r)return r=!1,a;var t=2*Math.random()-1,n=2*Math.random()-1,o=t*t+n*n;if(0==o||o>1)return e();var i=Math.sqrt(-2*Math.log(o)/o);return a=n*i,r=!0,t*i}()*t},i=function(e){if("undefined"===typeof e||isNaN(e))return[];if("undefined"===typeof ArrayBuffer){for(var t=new Array(e),n=0;n<e;n++)t[n]=0;return t}return new Float64Array(e)},s=function(e,t,n){for(var r="undefined"!==typeof n,a=[],i=0;i<e;i++){for(var s=[],c=0;c<t;c++)r?s.push(n):s.push(o(0,1e-4));a.push(s)}return a},c=function(e,t){for(var n=e.length,r=0,a=0;a<n;a++){var o=e[a],i=t[a];r+=(o-i)*(o-i)}return r},l=function(e,n,r){var a=Math.sqrt(e.length),o=Math.floor(a);t(o===a,"D should have square number of elements.");for(var s=Math.log(n),c=i(o*o),l=i(o),u=0;u<o;u++){for(var h=-1/0,d=1/0,f=1,p=!1,g=0;!p;){for(var v=0,_=0;_<o;_++){var m=Math.exp(-e[u*o+_]*f);u===_&&(m=0),l[_]=m,v+=m}var y=0;for(_=0;_<o;_++){if(0==v)m=0;else m=l[_]/v;l[_]=m,m>1e-7&&(y-=m*Math.log(m))}y>s?(h=f,d===1/0?f*=2:f=(f+d)/2):(d=f,h===-1/0?f/=2:f=(f+h)/2),g++,Math.abs(y-s)<r&&(p=!0),g>=50&&(p=!0)}for(_=0;_<o;_++)c[u*o+_]=l[_]}var x=i(o*o),b=2*o;for(u=0;u<o;u++)for(_=0;_<o;_++)x[u*o+_]=Math.max((c[u*o+_]+c[_*o+u])/b,1e-100);return x};function u(e){return e>0?1:e<0?-1:0}var h=function(e){e=e||{};this.perplexity=n(e,"perplexity",30),this.dim=n(e,"dim",2),this.epsilon=n(e,"epsilon",10),this.iter=0};h.prototype={initDataRaw:function(e){var n=e.length,r=e[0].length;t(n>0," X is empty? You must have some data!"),t(r>0," X[0] is empty? Where is the data?");var a=function(e){for(var t=e.length,n=i(t*t),r=0;r<t;r++)for(var a=r+1;a<t;a++){var o=c(e[r],e[a]);n[r*t+a]=o,n[a*t+r]=o}return n}(e);this.P=l(a,this.perplexity,1e-4),this.N=n,this.initSolution()},initDataDist:function(e){var n=e.length;t(n>0," X is empty? You must have some data!");for(var r=i(n*n),a=0;a<n;a++)for(var o=a+1;o<n;o++){var s=e[a][o];r[a*n+o]=s,r[o*n+a]=s}this.P=l(r,this.perplexity,1e-4),this.N=n,this.initSolution()},initSolution:function(){this.Y=s(this.N,this.dim),this.gains=s(this.N,this.dim,1),this.ystep=s(this.N,this.dim,0),this.iter=0},getSolution:function(){return this.Y},step:function(){this.iter+=1;for(var e=this.N,t=this.costGrad(this.Y),n=t.cost,r=t.grad,a=i(this.dim),o=0;o<e;o++)for(var s=0;s<this.dim;s++){var c=r[o][s],l=this.ystep[o][s],h=this.gains[o][s],d=u(c)===u(l)?.8*h:h+.2;d<.01&&(d=.01),this.gains[o][s]=d;var f=(this.iter<250?.5:.8)*l-this.epsilon*d*r[o][s];this.ystep[o][s]=f,this.Y[o][s]+=f,a[s]+=this.Y[o][s]}for(o=0;o<e;o++)for(s=0;s<this.dim;s++)this.Y[o][s]-=a[s]/e;return n},debugGrad:function(){for(var e=this.N,t=this.costGrad(this.Y),n=(t.cost,t.grad),r=1e-5,a=0;a<e;a++)for(var o=0;o<this.dim;o++){var i=this.Y[a][o];this.Y[a][o]=i+r;var s=this.costGrad(this.Y);this.Y[a][o]=i-r;var c=this.costGrad(this.Y),l=n[a][o],u=(s.cost-c.cost)/(2*r);console.log(a+","+o+": gradcheck analytic: "+l+" vs. numerical: "+u),this.Y[a][o]=i}},costGrad:function(e){for(var t=this.N,n=this.dim,r=this.P,a=this.iter<100?4:1,o=i(t*t),s=0,c=0;c<t;c++)for(var l=c+1;l<t;l++){for(var u=0,h=0;h<n;h++){var d=e[c][h]-e[l][h];u+=d*d}var f=1/(1+u);o[c*t+l]=f,o[l*t+c]=f,s+=2*f}for(var p=t*t,g=i(p),v=0;v<p;v++)g[v]=Math.max(o[v]/s,1e-100);var _=0,m=[];for(c=0;c<t;c++){var y=new Array(n);for(h=0;h<n;h++)y[h]=0;for(l=0;l<t;l++){_+=-r[c*t+l]*Math.log(g[c*t+l]);var x=4*(a*r[c*t+l]-g[c*t+l])*o[c*t+l];for(h=0;h<n;h++)y[h]+=x*(e[c][h]-e[l][h])}m.push(y)}return{cost:_,grad:m}}},e.tSNE=h}(r),function(t){"use strict";"undefined"===typeof e.exports?window.tsnejs=t:e.exports=t}(r)},262:function(e,t,n){},263:function(e,t,n){},264:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(5),i=n.n(o),s=(n(148),n(10)),c=n(11),l=n(4),u=n(12),h=n(13),d=n(271),f=n(127),p=n.n(f),g=(n(149),n(18)),v=n.n(g),_=n(27),m=(n(151),n(30)),y=(n(152),n(21)),x=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).global_simulation=null,r.saved_transform=null,r.refresh_number=0,r.updateTransform=r.updateTransform.bind(Object(l.a)(r)),r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderCanvas()}},{key:"componentDidUpdate",value:function(e,t){e.graph_json.name===this.props.graph_json.name&&e.width===this.props.width||this.renderCanvas()}},{key:"updateTransform",value:function(e){this.saved_transform=e}},{key:"renderCanvas",value:function(){var e=this.props.onNodeClick,t=this.props.graph_json.nodenum,n=this.props.graph_json.enable_forceDirected,r=this.props.graph_json.NeighborSet,a=this.props.graph_json.colorLegend,o=this.props.graph_json.pieLegend.pie_name,i={strength:.01,radius:15,showlabel:!0,showarrow:!0,width:this.props.width,height:this.props.height};t>=100&&(i={strength:.4,radius:3,showlabel:!1,showarrow:!1,width:this.props.width,height:this.props.height});var s=i.width,c=i.height,l=i.radius,u=l-.3,h=this.props.width,d=y.select("#force_directed_graph").select("#bottom").attr("width",h+"px").attr("height",c+"px").node().getContext("2d"),f=y.select("#force_directed_graph").select("#middle").attr("width",h+"px").attr("height",c+"px").node(),p=f.getContext("2d"),g=y.select("#force_directed_graph").select("#event").attr("width",h+"px").attr("height",c+"px").node();this.global_simulation&&(this.global_simulation.stop(),delete this.global_simulation);var v=y.forceSimulation().force("center",y.forceCenter(h/2,c/2)).force("x",y.forceX(h/2).strength(.1)).force("y",y.forceY(c/2).strength(.1)).force("charge",y.forceManyBody().strength(-50)).force("link",y.forceLink().strength(1).id((function(e){return e.id}))).alphaTarget(0).alphaDecay(.05);this.global_simulation=v;var _=c-10-100,m=y.select("#force_directed_graph").select("#svgChart").attr("width",s).attr("height",c),x=m.select("#ForceDirectedLegend").attr("width",100).attr("height",100).attr("transform","translate(10,"+_+")"),b=y.pie().startAngle(-60/180*Math.PI).endAngle((2-60/180)*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index}))([{index:0,value:1/3},{index:1,value:1/3},{index:2,value:1/3}]);this.refresh_number=this.refresh_number+1;var w=x.selectAll("g.legend_pie").data([this.refresh_number],(function(e){return e}));w.exit().remove();var C=w.enter().append("g").attr("class","legend_pie").attr("transform","translate(30,50)");C.append("rect").attr("x",-30).attr("y",-50).attr("width",200).attr("height",100).attr("fill","#fff").attr("opacity",.8).attr("stroke","#bbb").attr("stroke-width",1).attr("rx",3).attr("ry",3);var E=["#1f77b4","#ff7f0e","#2ca02c","#d62728"];C.append("circle").attr("class","inner_circle").attr("r",3*u).attr("fill",(function(e){return E[0]})).attr("stroke","white");var S=[{text:"Ground Truth","text-anchor":"begin","dominant-baseline":"central",y_offset:1},{text:o[0],"text-anchor":"begin","dominant-baseline":"central",y_offset:-7.5},{text:o[1],"text-anchor":"begin","dominant-baseline":"central",y_offset:0},{text:o[2],"text-anchor":"begin","dominant-baseline":"central",y_offset:19}];for(var M=function(e){var t=C.append("path").attr("class","arc_"+e),n=C.select("path.arc_"+e);t.merge(n).style("fill",(function(t){return E[e+1]})).attr("d",function(e){return y.arc().innerRadius(e).outerRadius(2*e)}(3*l)(b[e]));var r=[4.5*l*Math.sin(120*e/180*Math.PI),4.5*l*-Math.cos(120*e/180*Math.PI)],a=[4.5*l*Math.sin(120*e/180*Math.PI),7.5*l*-Math.cos(120*e/180*Math.PI)+S[e+1].y_offset];1===e&&(a=[7.5*l*Math.sin(120*e/180*Math.PI),7.5*l*-Math.cos(120*e/180*Math.PI)+S[e+1].y_offset]);var o=[7.5*l*Math.sin(60/180*Math.PI),7.5*l*-Math.cos(120*e/180*Math.PI)+S[e+1].y_offset];C.append("path").attr("stroke","#222").attr("stroke-width",1).attr("d",function(e){for(var t="",n=0;n<e.length;n++){var r="M";n>0&&(r="L"),t=t+r+e[n][0]+" "+e[n][1]+" "}return t}([r,a,o])).attr("fill","none"),C.append("text").attr("x",o[0]).attr("y",o[1]).attr("text-anchor",S[e+1]["text-anchor"]).attr("dominant-baseline",S[e+1]["dominant-baseline"]).text(S[e+1].text)},N=0;N<3;N++)M(N);var k=7.5*l*Math.sin(60/180*Math.PI),L=7.5*l*-Math.cos(60/180*Math.PI)+S[0].y_offset;C.append("line").attr("stroke","#222").attr("stroke-width",1).attr("x1",0).attr("y1",0).attr("x2",k).attr("y2",L),C.append("text").attr("x",k).attr("y",L).attr("text-anchor",S[0]["text-anchor"]).attr("dominant-baseline",S[0]["dominant-baseline"]).text(S[0].text);var I=0;a.forEach((function(e){var t=""+e.text;t.length>I&&(I=t.length)}));var P=8*I+24,O=20*a.length,j=_-O-10,D=m.select("#ForceDirectedColorLegend").attr("width",P).attr("height",O).attr("transform","translate(10,"+j+")"),A=D.selectAll("rect").data([0]);A.enter().append("rect").merge(A).attr("x",0).attr("y",0).attr("width",P).attr("height",O).attr("fill","#fff").attr("opacity",.8).attr("stroke","#bbb").attr("stroke-width",1).attr("rx",3).attr("ry",3);var G=D.selectAll("g.legend_row_color").data(a,(function(e,t){return e.text+"_"+t+"_"+e.color})),T=G.enter().append("g").attr("class","legend_row_color").attr("transform",(function(e,t){return"translate(10,"+(10+20*t)+")"}));T.append("circle").attr("r",5).attr("fill",(function(e){return e.color})),T.append("text").attr("x",10).attr("y",5).text((function(e){return e.text})),G.exit().remove();var R,F=this.updateTransform;R=this.saved_transform?this.saved_transform:y.zoomIdentity,function(t){var a=g;function o(e,t){var n=e.hasOwnProperty("hover_cons")?e.hover_cons:1,r=t.hasOwnProperty("hover_cons")?t.hover_cons:1;return e.radius*n*2<e.radius*r*2?-1:1}function i(e,n){var r,a,i,s=R.invertX(e),c=R.invertY(n),l=t.nodes.slice().sort(o);for(r=l.length-1;r>=0;--r){var u=l[r];a=s-u.x,i=c-u.y;var h=u.hasOwnProperty("hover_cons")?u.hover_cons:1,d=2*u.radius*h;if(a*a+i*i<d*d)return u}return null}function s(e,t){return e.hasOwnProperty("hovered")&&!1!==e.hovered?!0!==t:!1!==t}y.select(a).on("click",(function(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1],!y.event.defaultPrevented&&(n?t=l:(t=y.mouse(this),l=t),t)){var r=i(t[0],t[1]);r&&e(r.id)}})).on("mousemove",_).on("mouseout",(function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e;l=null,t.nodes.forEach((function(e){n=n||s(e,!1),e.hovered=!1,e.hover_cons=1})),u(),n&&S()}));var l=null;function u(){y.select("#force_directed_graph").select("#tooltip").style("opacity",0)}function _(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];n?e=l:(e=y.mouse(this),l=e);var o=a;if(e){var c=i(e[0],e[1]);if(c){o=!0;var h=c.id;y.select("#force_directed_graph").select("#tooltip").style("opacity",.8).style("top",e[1]+5+"px").style("left",e[0]+5+"px").html(h);var d=r[c.id];t.nodes.forEach((function(e){h===e.id?(e.hovered=!0,e.hover_cons=3):d.indexOf(e.id)>=0?(e.hovered=!0,e.hover_cons=2):(e.hovered=!1,e.hover_cons=1)}))}else t.nodes.forEach((function(e){o=o||s(e,!1),e.hovered=!1,e.hover_cons=1})),u()}else t.nodes.forEach((function(e){o=o||s(e,!1),e.hovered=!1,e.hover_cons=1})),u();o&&S()}function m(e,t,n,r,a,o){e.lineWidth=o,e.strokeStyle=t,e.beginPath(),e.arc(r,a,n,0,2*Math.PI,!0),e.stroke()}function x(e,t,n,r,a){e.beginPath(),e.arc(r,a,n,0,2*Math.PI,!0),e.fillStyle=t,e.fill()}function b(e,t,n,r,a,o,i){e.beginPath(),e.moveTo(r,a),e.arc(r,a,n,o,i),e.fillStyle=t,e.closePath(),e.fill()}function w(e,t,n,r,a,o,i){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];x(e,t[4],a,o,i),s&&m(e,"#000",a,o,i,2),b(e,t[1],a,o,i,-150/180*Math.PI,-30/180*Math.PI),b(e,t[2],a,o,i,-30/180*Math.PI,.5*Math.PI),b(e,t[3],a,o,i,.5*Math.PI,210/180*Math.PI),x(e,t[4],r,o,i),x(e,t[0],n,o,i)}function C(e,t,n,r,a,o){e.strokeStyle=t,e.beginPath(),e.moveTo(n,r),e.lineTo(a,o),e.stroke()}function E(){d.save(),d.clearRect(0,0,h,c),d.translate(R.x,R.y),d.scale(R.k,R.k),t.links.filter((function(e){return!e.source.highlight||!e.target.highlight})).forEach((function(e){C(d,e.color,e.source.x,e.source.y,e.target.x,e.target.y)})),t.nodes.filter((function(e){return!e.highlight})).forEach((function(e,t){var n=e.radius-.3,r=e.radius,a=2*e.radius;w(d,e.color,n,r,a,e.x,e.y)})),t.links.filter((function(e){return!(!e.source.highlight||!e.target.highlight)})).forEach((function(e){C(d,e.color,e.source.x,e.source.y,e.target.x,e.target.y)})),t.nodes.filter((function(e){return e.highlight})).forEach((function(e,t){var n=e.radius-.3,r=e.radius,a=2*e.radius;w(d,e.color,n,r,a,e.x,e.y)})),d.restore(),_(f,!0)}function S(){var e=function(e){return!(!e.hasOwnProperty("hovered")||!e.hovered)};p.save(),p.clearRect(0,0,h,c),p.translate(R.x,R.y),p.scale(R.k,R.k),t.links.filter((function(t){return!(!e(t.source)||!e(t.target))})).forEach((function(e){C(p,e.real_color,e.source.x,e.source.y,e.target.x,e.target.y)})),t.nodes.filter((function(t){return e(t)})).sort(o).forEach((function(e,t){var n=e.radius-.3,r=e.radius,a=2*e.radius;w(p,e.real_color,n*e.hover_cons,r*e.hover_cons,a*e.hover_cons,e.x,e.y,!0)})),p.restore()}y.select(a).call(y.zoom().scaleExtent([.1,8]).on("zoom",(function(){var e=y.mouse(this);l=e,R=y.event.transform,F(R),E()}))),n?(v.nodes(t.nodes).on("tick",E),v.force("link").links(t.links)):(v.stop(),v.nodes(t.nodes),v.force("link").links(t.links),E())}(this.props.graph_json)}},{key:"render",value:function(){return r.createElement("div",{id:"force_directed_graph"},r.createElement("canvas",{id:"bottom",className:"AbsPos"}),r.createElement("canvas",{id:"middle",className:"AbsPos"}),r.createElement("svg",{id:"svgChart",xmlns:"http://www.w3.org/2000/svg",className:"AbsPos"},r.createElement("g",{id:"ForceDirectedLegend"}),r.createElement("g",{id:"ForceDirectedColorLegend"})),r.createElement("div",{id:"tooltip",className:"AbsPos"}),r.createElement("canvas",{id:"event",className:"AbsPos"}))}}]),n}(r.Component),b=n(268),w=n(273),C=n(269),E=n(274),S=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],M=["#498B77","#89C2AE","#C1D6D3"],N=["#3E97C7","#72B3CF","#8FCCDD","#C8DADE"],k=["#DC143C"],L=["#999999"],I=function(e,t){var n=e.length,r=1/(n-1),a=Math.floor(t/r);a==n-1&&(a-=1);var o=(t-a*r)/r;return P(e[a],e[a+1],o)},P=function(e,t,n){var r=function(e){if((e=e.toLowerCase())&&/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(e)){if(4===e.length){for(var t="#",n=1;n<4;n+=1)t+=e.slice(n,n+1).concat(e.slice(n,n+1));e=t}var r=[];for(n=1;n<7;n+=2)r.push(parseInt("0x"+e.slice(n,n+2)));return r}return e};e=e.replace(/\s+/g,""),t=t.replace(/\s+/g,"");var a=r(e),o=a[0],i=a[1],s=a[2],c=r(t),l=c[0],u=c[1],h=c[2];n>1?(console.log("out of range step: ",n),n=1):n<0&&(console.log("out of range step: ",n),n=0);var d=(u-i)*n,f=(h-s)*n,p=parseInt((l-o)*n+o),g=parseInt(d+i),v=parseInt(f+s),_="#",m=new Array;m[0]=p,m[1]=g,m[2]=v;for(var y=0;y<3;y++){var x=Number(m[y]).toString(16),b=Number(m[y])<10?"0"+x:x;"0"===b&&(b+=b),_+=b}return _},O=N[1],j=N[0],D=k[0],A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return 1===t||2===t||3===t?S[e]:5===t?e?M[0]:k[0]:void 0},G=function(e){return 0===e?N[0]:L[0]},T=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(1==e){if(1==t[0])return k[0];if(-1==t[0]&&-1==t[1])return N[0];if(-1==t[0]&&1==t[1])return M[0]}else if(2==e){if(1==t[0])return k[0];if(0==t[0])return N[0]}else{if(3==e){var r=1/(1+Math.exp(-t[0]));return I([j,"#FFFFFF",D],r)}if(4==e){if(0===n){var a=1/(1+Math.exp(-t));return I([j,"#FFFFFF",D],a)}if(1===n){var o=t;return o>1?(console.log("Out of Range Value: ",o),o=1):o<0&&(console.log("Out of Range Value: ",o),o=0),I(["#FFFFFF",D],o)}if(2===n){var i=t;return i>1?(console.log("Out of Range Value: ",i),i=1):i<0&&(console.log("Out of Range Value: ",i),i=0),I([j,"#FFFFFF",D],i)}}}return O},R=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(1==e||2==e||3==e){if(1==t[0])return N[2];if(-1==t[0])return L[0]}else if(4==e){if(0===n){var r=1/(1+Math.exp(-t));return I([j,"#DDDDDD",D],r)}if(1===n){var a=t;return a>1?(console.log("Out of Range Value: ",a),a=1):a<0&&(console.log("Out of Range Value: ",a),a=0),I(["#DDDDDD",D],a)}}return O};function F(e){for(var t=e.senders,n=e.receivers,r=e.feature.length,a={},o=0;o<r;o++)a[o]=[];for(var i=0;i<n.length;i++){var s=n[i];s in a||(a[s]=[]),a[s].push(t[i])}return a}function V(e){for(var t=e.senders,n=e.receivers,r=e.values,a={},o=0;o<n.length;o++){var i=n[o];i in a||(a[i]={}),a[i][t[o]]=r[o]}return a}function H(e,t){return t.has(e)?"#000":"#fff"}function U(e,t){var n=e+"/"+t;return 0===t||(n=n+" ("+(e/t*100).toFixed(2)+"%)"),n}var W=["Train","Valid","Test","Others"];function z(e,t){if(e.length===t.length){for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return!1}var B=b.a.Option,J=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).prevGraphJson=null,r.onEnableForceDirected=r.onEnableForceDirected.bind(Object(l.a)(r)),r.onExtendedModeChange=r.onExtendedModeChange.bind(Object(l.a)(r)),r.onNodeClick=r.onNodeClick.bind(Object(l.a)(r)),r.onChangeSelectInspectNode=r.onChangeSelectInspectNode.bind(Object(l.a)(r)),r.state={enableForceDirected:!1},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){}},{key:"onNodeClick",value:function(e){!1===this.props.showSource?(this.props.changeSelectInspectNode(e),this.props.changeShowSource(!0),this.props.changeExtendedMode(3)):this.props.changeSelectInspectNode(e)}},{key:"constructGraphJson",value:function(e,t,n,r,a,o,i,s,c,l,u,h){var d,f=o.join("_"),p=e,g=e;p=e.common,g=e.individual,d=p.name+"_"+p.dataset_id+"_"+t+"_"+p.data_type_id+"_SELECTED_"+f+"_SELECTEDEND_"+i+"_"+u+"_"+h+"_"+l+"_",4==t&&(d=d+"_"+n);var v,_,y=p.graph_in,x=p.graph_target,b=p.graph_explaination,w=p.graph_layout,C=p.mask,E=new Set(C.train);if(v={GCN:g.GCN.graph_out,MLP:g.MLP.graph_out,GCN_Identity_features:g.GCN_Identity_features.graph_out},0===o.length){o=[];for(var S=0;S<w.length;S++)o.push(S)}if(l>=0){_=p.embedding[{0:"input",1:"hidden",2:"output"}[""+l]]}else _=w;var M=i;_.length>0&&(_=function(e){if(0===e.length)return e;var t=function(e){if(0===e.length)return{xmin:0,xmax:0,ymin:0,ymax:0};for(var t=e[0][0],n=e[0][0],r=e[0][1],a=e[0][1],o=0;o<e.length;o++){var i=e[o][0],s=e[o][1];t>i&&(t=i),n<i&&(n=i),r>s&&(r=s),a<s&&(a=s)}return{xmin:t,xmax:n,ymin:r,ymax:a}}(e),n=20;e.length>=100&&(n=20);var r=u-2*n,a=h-2*n,o=t.xmax-t.xmin,i=t.ymax-t.ymin;0===o&&(o=1e-16),0===i&&(i=1e-16);for(var s=Math.min(r/o,a/i),c=n+(r-s*o)/2,l=n+(a-s*i)/2,d=t.xmin,f=t.ymin,p=[],g=0;g<e.length;g++){var v=c+(e[g][0]-d)*s,_=l+(e[g][1]-f)*s;p.push([v,_])}return p}(_));var N=p.data_type_id,k=p.task;function L(e,t,n){return(e-n)/(t-n+1e-16)}if(1==N){var I,P,O,j,D=y.node_features.length,G=y.edge_features.length,F=y.senders,V=y.receivers,U=[],W=[],z=[],B=1;if("LRP"===b.type&&"node_classification"==k&&(B=0),"graph_classification"==k&&(B=2,2==t||3==t))return console.log("out of range show_mode for graph_classification task",t),a(1),{success:!1};if(n>=D)return console.log("out of range explained_node:",n),r(0),{success:!1};if(I=P=O=j=0,"graph_classification"==k){n=0;for(var J=b.node_importance[n],Y=b.edge_importance[n],X=0,q=0,Z=0;Z<J.length;Z++)X<Math.abs(J[Z])&&(X=Math.abs(J[Z]));for(var K=0;K<Y.length;K++)q<Math.abs(Y[K])&&(q=Math.abs(Y[K]));I=X,P=-X,O=q,j=-q}else{var $=b.node_importance[n],Q=b.edge_importance[n];I=Math.max.apply(Math,Object(m.a)($)),P=Math.min.apply(Math,Object(m.a)($)),O=Math.max.apply(Math,Object(m.a)(Q)),j=Math.min.apply(Math,Object(m.a)(Q))}for(var ee=0;ee<D;ee++){var te="#999";if(1==t)te=T(t,y.node_features[ee]);else if(2==t)te=T(t,x.node_features[ee]);else if(3==t)te=T(t,v.node_features[ee]);else if(4==t){var ne=b.node_importance[n][ee];"SA"!==b.type&&"GBP"!==b.type&&"graph_classification"!=k||(ne=L(ne,I,P)),te=T(t,ne,B)}var re={id:ee,group:1,color:te};!1===M&&(re.x=w[ee][0],re.y=w[ee][1]),U.push(re)}for(var ae=0;ae<G;ae++){var oe=void 0;if(1==t||2==t||3==t)oe=R(t,y.edge_features[ae]);else{var ie=b.edge_importance[n][ae];"SA"!==b.type&&"GBP"!==b.type||(ie=L(ie,O,j)),oe=R(t,ie)}z.indexOf(oe)>=0||z.push(oe),W.push({source:F[ae],target:V[ae],value:1,color:oe})}return{success:!0,name:d,nodes:U,links:W,links_color:z,nodenum:D,edgenum:G,enable_forceDirected:M}}if(2==N){var se=y.senders,ce=y.receivers,le=x.node_features.length,ue=!1,he=this.prevGraphJson;he&&he.success&&he.nodes.length===le&&(ue=!0);for(var de=y.senders.length,fe=[],pe=[],ge=[],ve=0;ve<le;ve++){var _e=void 0,me=ve,ye=void 0,xe=void 0,be=1,we=x.node_features[me];_e=we;var Ce=v.GCN.node_features[me],Ee=v.MLP.node_features[me],Se=v.GCN_Identity_features.node_features[me];xe=(ye=[A(we,2),A(Ce,3),A(Ee,3),A(Se,3),H(me,E)]).slice(),o.indexOf(me)>=0||(ye=["#ddd","#ddd","#ddd","#ddd","#ddd"],be=0);var Me=3;me===s&&!0===c&&(Me=6);var Ne={id:me,group:_e,color:ye,real_color:xe,radius:Me,highlight:be};ue?(Ne.x=he.nodes[ve].x,Ne.y=he.nodes[ve].y):!1===M&&(Ne.x=_[ve][0],Ne.y=_[ve][1]),fe.push(Ne)}for(var ke=0;ke<de;ke++){var Le="#eee";o.indexOf(se[ke])>=0&&o.indexOf(ce[ke])>=0&&(Le="#bbb"),ge.indexOf(Le)>=0||ge.push(Le),pe.push({source:se[ke],target:ce[ke],value:1,color:Le,real_color:"#bbb"})}var Ie=[g.GCN.real_model_name,g.MLP.real_model_name,g.GCN_Identity_features.real_model_name];return{success:!0,name:d,nodes:fe,links:pe,links_color:ge,nodenum:le,edgenum:de,enable_forceDirected:M,colorLegend:function(){var e=p.graph_additional_info,t=e.num_class,n=[];if(Object.keys(e).indexOf("idx_to_class")>=0)for(var r=e.idx_to_class,a=0;a<t;a++)n.push({text:a+":"+r[a],color:A(a,2)});else for(var o=0;o<t;o++)n.push({text:o,color:A(o,2)});return n}(),pieLegend:{pie_name:Ie}}}return console.log("Unknown data type : ",N),{success:!1}}},{key:"onEnableForceDirected",value:function(e){this.setState({enableForceDirected:e})}},{key:"onExtendedModeChange",value:function(e){this.props.changeExtendedMode(e)}},{key:"constructExtendedSelectedNodeIdList",value:function(e,t){if(0===e.length)return[];for(var n=e.slice(),r=0;r<e.length;r++){var a=e[r];n=n.concat(t[a])}return n=Array.from(new Set(n))}},{key:"onChangeSelectInspectNode",value:function(e,t){var n=parseInt(e);(!n||n<0)&&(n=0),n>=t&&(n=t-1),console.log("graphview, new_node_id",n),this.props.changeSelectInspectNode(n)}},{key:"render",value:function(){var e=this,t=this.props,n=t.graph_object,a=t.show_mode,o=t.explained_node,i=t.onExplainNodeChange,s=t.onShowModeChange,c=(t.model,t.modelList,t.selectedNodeIdList),l=(t.selectedMessagePassingNodeIdList,t.showSource),u=t.select_inspect_node,h=t.width,d=t.height,f=t.extendedMode,p=this.onNodeClick,g=c;l&&(g=[u]);var v=n,_=F((v=n.common).graph_in);2===f?g=this.constructExtendedSelectedNodeIdList(g,_):3===f&&(g=this.constructExtendedSelectedNodeIdList(g,_),g=this.constructExtendedSelectedNodeIdList(g,_)),this.props.changeSpecificNodeIdList(g);var m=h-10,y=d-50,S=this.constructGraphJson(n,a,o,i,s,g,this.state.enableForceDirected,u,l,-1,m,y);if(S.NeighborSet=_,S.success&&(this.prevGraphJson=S),S.success){var M=S.nodenum,N=v.task;"node_classification"==N?2==v.data_type_id&&[[1,"Input Feature"],[2,"Ground Truth"],[3,"Model Output"],[5,"True / False"]]:"graph_classification"==N&&[[1,"Input Feature"],[4,"Explaination"]];return r.createElement("div",{style:{width:"100%",height:this.props.height-10+"px",overflowX:"hidden"}},r.createElement("div",{className:"ViewTitle"},"Graph View",r.createElement("div",{style:{float:"right"}},l?[r.createElement("span",{key:"span1"},"Id:"),r.createElement(C.a,{min:0,max:M,size:"small",value:u,onChange:function(t){e.onChangeSelectInspectNode(t,M)}}),r.createElement("span",{key:"span3"},"\xa0"),r.createElement(E.a,{size:"small",onClick:function(){e.props.changeShowSource(!1),e.props.changeExtendedMode(1)}},"X")]:[r.createElement("span",{key:"span2"})],"\xa0\xa0\xa0\xa0 Extended:\xa0",r.createElement(b.a,{placeholder:"Select an extended mode",value:f,style:{width:"90px"},onChange:this.onExtendedModeChange,size:"small"},[[1,"None"],[2,"One Hop"],[3,"Two Hop"]].map((function(e){return r.createElement(B,{value:e[0],key:e[0]},e[1])}))),"\xa0\xa0\xa0\xa0",this.state.enableForceDirected?r.createElement(E.a,{type:"primary",size:"small",onClick:function(){e.onEnableForceDirected(!1)}},"Stop Layout"):r.createElement(E.a,{type:"default",size:"small",onClick:function(){e.onEnableForceDirected(!0)}},"Start Layout"),"\xa0\xa0\xa0\xa0 #Nodes: ",r.createElement(w.a,null,U(g.length,M)," "))),r.createElement("div",{className:"ViewBox"},r.createElement("div",null),r.createElement("div",{style:{width:"100%"}},r.createElement(x,{graph_json:S,width:m,height:y,onNodeClick:p}))))}return r.createElement("div",null)}}]),n}(r.Component),Y=n(16),X=function(e){return{type:"MATRIX_FILTERS_CHANGE",matrixFilters:e}},q=function(e){return{type:"SELECT_INSPECT_NODE_CHANGE",select_inspect_node:e}},Z=function(e){return{type:"SHOW_SOURCE_CHANGE",showSource:e}},K=Object(Y.b)((function(e){return{selectedNodeIdList:e.selectedNodeIdList,selectedMessagePassingNodeIdList:e.selectedMessagePassingNodeIdList,showSource:e.showSource,select_inspect_node:e.select_inspect_node,extendedMode:e.extendedMode}}),(function(e){return{changeSpecificNodeIdList:function(t){return e(function(e){return{type:"SPECIFIC_NODE_ID_LIST_CHANGE",specificNodeIdList:e}}(t))},changeSelectInspectNode:function(t){return e(q(t))},changePrevGraphJson:function(t){return e(function(e){return{type:"PREV_GRAPH_JSON_CHANGE",prevGraphJson:e}}(t))},changeShowSource:function(t){return e(Z(t))},changeExtendedMode:function(t){return e(function(e){return{type:"EXTENDED_MODE_CHANGE",extendedMode:e}}(t))}}}))(J),$=(n(210),n(21)),Q=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).TAB="RadialTree_",r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){e.graph_json.name!==this.props.graph_json.name&&($.selectAll("#RadialTree"+this.props.id).remove(),this.renderD3())}},{key:"renderD3",value:function(){var e=this.props.graph_json.RadialData,t=this.props.width,n=this.props.height,r=Math.min(t/2,n/2)-40,a=2.5,o=7;e.length>=50&&(a=2.5,o=7);var i=$.select("#"+this.TAB+this.props.id),s=i.append("g").attr("id","RadialTree"+this.props.id).attr("width",t).attr("height",n),c=(s.append("rect").attr("width",t).attr("height",n).attr("fill","white"),s.append("g").attr("transform","translate("+t/2+","+n/2+")"));i.call($.zoom().extent([[0,0],[t,n]]).scaleExtent([.1,8]).on("zoom",(function(){s.attr("transform",$.event.transform)})));var l=$.stratify().parentId((function(e){return e.id.substring(0,e.id.lastIndexOf("."))}));function u(e,t){var n=(e-90)/180*Math.PI,r=t;return[r*Math.cos(n),r*Math.sin(n)]}var h=$.tree().size([360,r]).separation((function(e,t){return(e.parent===t.parent?1:2)/e.depth}))(l(e)),d=(c.selectAll(".link").data(h.descendants().slice(1)).enter().append("path").attr("class","link").attr("stroke",(function(e){return e.data.link_color})).attr("d",(function(e){return"M"+u(e.x,e.y)+"C"+u(e.x,(e.y+e.parent.y)/2)+" "+u(e.parent.x,(e.y+e.parent.y)/2)+" "+u(e.parent.x,e.parent.y)})),c.selectAll(".node").data(h.descendants()).enter().append("g").attr("class",(function(e){return"node"+(e.children?" node--internal":" node--leaf")})).attr("transform",(function(e){return"translate("+u(e.x,e.y)+")"})));d.append("circle").attr("r",a).attr("fill",(function(e){return e.data.color})),d.append("text").attr("dy",".31em").attr("x",(function(e){return e.x<180===!e.children?6:-6})).attr("fill",(function(e){return e.data.text_color})).style("font-size",o+"px").style("text-anchor",(function(e){return e.x<180===!e.children?"start":"end"})).attr("transform",(function(e){return"rotate("+(e.x<180?e.x-90:e.x+90)+")"})).text((function(e){return e.id.substring(e.id.lastIndexOf(".")+1)}))}},{key:"render",value:function(){return r.createElement("g",{transform:"translate("+this.props.x+","+this.props.y+")",style:{height:this.props.height+"px",width:this.props.width+"px"},id:this.TAB+this.props.id})}}]),n}(r.Component),ee=n(270),te=b.a.Option,ne=(n(21),function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onSelectNodeChange=r.onSelectNodeChange.bind(Object(l.a)(r)),r.onColorEncodeChange=r.onColorEncodeChange.bind(Object(l.a)(r)),r.onShowSourceChange=r.onShowSourceChange.bind(Object(l.a)(r)),r.state={color_encode:2},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){}},{key:"onSelectNodeChange",value:function(e){this.props.changeSelectInspectNode(e)}},{key:"onColorEncodeChange",value:function(e){this.setState({color_encode:e})}},{key:"constructRadialTreeJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],e.name+"_"+e.dataset_id+"_"+e.model+"_"+e.explain_id+"_"+e.graph+"_"+e.data_type_id+"_"+t+"_"+n),o=(e.graph_in,e.graph_target),i=e.graph_out,s=e.graph_explaination,c=s.type,l=e.mask,u=l.train;if("MessagePassing"!==c)return console.log("Unsupported explaination type , ",c),{success:!1};var h=o.node_features.length;if(!(t>=0&&t<h))return console.log("Out of the range,  select_node , ",t),{success:!1};var d=e.message_passing,f=V(d);function p(e){var t=o.node_features[e];return 2===n?t=o.node_features[e]:3===n?t=i.node_features[e]:5===n&&(t=o.node_features[e]===i.node_features[e]),A(t,n)}function g(e){var t=u.indexOf(e);return G(t>=0?0:1)}function v(e,t,n){return(e-n)/(t-n+1e-16)}function _(e,t,n){var r=[],a=[];r.push({id:""+t,data_id:t,level:0,value:0,color:p(t),text_color:g(t)});for(var o=0;o<r.length;o++){var i=r[o],s=i.level;if(s>=n)break;for(var c=i.data_id,l=Object.keys(e[c]),u=0;u<l.length;u++){var h=parseInt(l[u]),d=e[c][h];a.push(d),r.push({id:i.id+"."+h,data_id:h,level:s+1,value:d,color:p(h),text_color:g(h)})}}for(var f=Math.min.apply(Math,a),_=Math.max.apply(Math,a),m=0;m<r.length;m++)if(r[m].level>=1){var y=r[m].value;y=v(y,_,f),r[m].link_color=R(4,y,1)}else r[m].link_color="#999999";return r}var m=e.data_type_id,y=(e.task,_(f,t,r));if(2===m){var x={success:!0,name:a,RadialData:y,nodenum:y.length};return x}return console.log("Unknown data type : ",m),{success:!1}}},{key:"constructPathGraphJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,a=(arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]&&arguments[7],e.name+"_"+e.dataset_id+"_"+e.model+"_"+e.explain_id+"_"+e.graph+"_"+e.data_type_id+"_"+t+"_"+n),o=(e.graph_in,e.graph_target),i=e.graph_out,s=e.graph_explaination,c=s.type;if("MessagePassing"!==c)return console.log("Unsupported explaination type , ",c),{success:!1};var l=o.node_features.length;if(!(t>=0&&t<l))return console.log("Out of the range,  select_node , ",t),{success:!1};var u=e.message_passing;function h(e){for(var t=e.senders,n=e.receivers,r=e.values,a={},o=0;o<n.length;o++){var i=n[o];i in a||(a[i]={}),a[i][t[o]]=r[o]}return a}var d=h(u);function f(e,t,n){var r=[],a=[],o=[],i=[],s=0,c={};function l(e){return e in c||(c[e]=s,s+=1),c[e]}r.push([t]),l(t+"_0");for(var u=0;u<n;u++){for(var h=r[u],d=u+1,f=[],p=0;p<h.length;p++)for(var g=h[p],v=l(g+"_"+u),_=Object.keys(e[g]),m=0;m<_.length;m++){var y=parseInt(_[m]),x=void 0;f.indexOf(y)>=0||f.push(y),x=l(y+"_"+d),a.push(x),o.push(v),i.push(e[g][y])}r.push(f)}return{PathLevel:r,sourcelist:a,targetlist:o,valuelist:i,nodeid_dict:c}}var p=e.data_type_id,g=(e.task,f(d,t,r));function v(e,t,n){return(e-n)/(t-n+1e-16)}if(2==p){for(var _=g.PathLevel,y=g.sourcelist,x=g.targetlist,b=g.valuelist,w=Math.min.apply(Math,Object(m.a)(b)),C=Math.max.apply(Math,Object(m.a)(b)),E=g.nodeid_dict,S=y.length,M=[],N=[],k=[],L=0;L<_.length;L++)for(var I=_[L],P=700-(300*L+20),O=I.length+2,j=300,D=j/O,G=0+D,T=0;T<I.length;T++){var F=G+D*T,V=I[T],H=E[V+"_"+L],U=o.node_features[V];2===n?U=o.node_features[V]:3===n&&(U=i.node_features[V]);var W={id:H,data_id:V,group:U,color:A(U),x:P,y:F};M.push(W)}for(var z=0;z<S;z++){var B="#999",J=b[z];J=v(J,C,w),B=R(4,J,1),k.indexOf(B)>=0||k.push(B),N.push({source:y[z],target:x[z],value:1,color:B})}var Y={success:!0,name:a,nodes:M,links:N,links_color:k,nodenum:M.length,edgenum:S};return Y}return console.log("Unknown data type : ",p),{success:!1}}},{key:"getAccuracy",value:function(e,t,n){for(var r=0,a=0;a<e.length;a++){t[e[a]]!==n[e[a]]&&(r+=1)}return 1-r/e.length}},{key:"getMisclassified",value:function(e){for(var t=[],n=e.graph_target,r=e.graph_out,a=n.node_features.length,o=0;o<a;o++){var i=n.node_features[o],s=r.node_features[o];i!==s&&t.push([o,i,s])}var c=1-t.length/a,l=e.mask,u=n.node_features,h=r.node_features;return{overall_accuracy:c,train_accuracy:this.getAccuracy(l.train,u,h),test_accuracy:this.getAccuracy(l.test,u,h),valid_accuracy:this.getAccuracy(l.valid,u,h),Misclassified:t}}},{key:"notifyMessagePassingNodeIdList",value:function(e){if(e.success){var t=e.RadialData.map((function(e){return e.data_id}));t=Array.from(new Set(t)),this.props.changeMessagePassingNodeIdList(t)}else this.props.changeMessagePassingNodeIdList([])}},{key:"onShowSourceChange",value:function(e){this.props.changeShowSource(e.target.checked)}},{key:"render",value:function(){var e=this.props,t=e.graph_object;e.model,e.modelList,this.getMisclassified(t);var n,a,o,i=t.graph_explaination.type,s=(t.graph_target,t.graph_out,this.props.select_inspect_node);if("MessagePassing"==i){var c=this.constructRadialTreeJson(t,s,this.state.color_encode);this.notifyMessagePassingNodeIdList(c);var l=this.props,u=l.width,h=l.height,d=u+"px",f=h+"px",p=u-20,g=h-20,v=t.graph_target.node_features.length;return r.createElement("div",null,r.createElement("div",{className:"ViewTitle"},"Message Passing View"),r.createElement("div",{className:"ViewBox"},"Select Node: ",function(e,t,n){for(var a=[],o=0;o<e;o++)a.push(o);return r.createElement(b.a,{showSearch:!0,placeholder:"Select a node",value:t,style:{width:"100px"},onChange:n},a.map((function(e){return r.createElement(te,{key:e,value:e},e)})))}(v,s,this.onSelectNodeChange),"Color Encode: ",(n=[[2,"Ground Truth"],[3,"Model Output"],[5,"True / False"]],a=this.state.color_encode,o=this.onColorEncodeChange,r.createElement(b.a,{placeholder:"Select a color",value:a,style:{width:"200px"},onChange:o},n.map((function(e){return r.createElement(te,{key:e[0],value:e[0]},e[1])})))),5===this.state.color_encode?r.createElement(w.a,{color:A(1,5)},"True"):"",5===this.state.color_encode?r.createElement(w.a,{color:A(0,5)},"False"):"","Text Encode: ",r.createElement(w.a,{color:G(0)},"Train"),"   ",r.createElement(w.a,{color:G(1)},"Others"),r.createElement(ee.a,{checked:this.props.showSource,onChange:this.onShowSourceChange},"Show Select Node in Graph View"),r.createElement("div",{style:{height:f,width:d,borderTop:".6px solid rgba(0,0,0, 0.4)"}},r.createElement("svg",{style:{height:"100%",width:"100%"},id:"TopSVGChart",xmlns:"http://www.w3.org/2000/svg"},r.createElement(Q,{x:20,y:20,width:p,height:g,graph_json:c,id:1}," ")))))}return r.createElement("div",null,"Please choose message passing explanation method.")}}]),n}(r.Component)),re=(Object(Y.b)((function(e){return{showSource:e.showSource,select_inspect_node:e.select_inspect_node}}),(function(e){return{changeMessagePassingNodeIdList:function(t){return e(function(e){return{type:"SELECTED_MESSAGE_PASSING_NODE_ID_LIST_CHANGE",selectedMessagePassingNodeIdList:e}}(t))},changeShowSource:function(t){return e(Z(t))},changeSelectInspectNode:function(t){return e(q(t))}}}))(ne),n(211),n(21)),ae=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).TAB="ScatterPlot_",r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){e.graph_json.name===this.props.graph_json.name&&e.id===this.props.id||this.renderD3()}},{key:"renderD3",value:function(){var e=this.props.graph_json.nodenum,t={radius:15,showlabel:!0,width:this.props.width,height:this.props.height};console.log("ScatterPlot",e),e>=100&&(t={radius:1,showlabel:!1,width:this.props.width,height:this.props.height});var n=re.select("#TopSVGChart_ScatterPlot"),r=re.select("#"+this.TAB),a=t.width,o=t.height,i=r.select("#ScatterPlot_sub");i.attr("width",a).attr("height",o),n.call(re.zoom().extent([[0,0],[a,o]]).scaleExtent([.1,8]).on("zoom",(function(){r.attr("transform",re.event.transform)})));var s=re.transition().duration(1e3).ease(re.easeLinear);!function(e){var n=i.select("g.nodes").selectAll("g").data(e.nodes,(function(e){return e.id}));console.log("EmbeddingView nodes enter update exit"),console.log(n.enter().size()),console.log(n.size()),console.log(n.exit().size());var r=n.enter().append("g");n.merge(r),n.exit().remove();var a=r.append("circle"),o=n.select("circle"),c=o.merge(a);if(console.log("Circles",a,a.size(),o,o.size()),c.transition(s).attr("r",t.radius).attr("fill",(function(e){return e.color})),t.showlabel){var l=r.append("text"),u=n.select("text");l.merge(u).text((function(e){return e.id})).attr("fill","#000").attr("text-anchor","middle").attr("x",0).attr("y",4),c.attr("stroke","#222")}var h=r.append("title");n.select("title").merge(h).text((function(e){return e.id})),r.merge(n).transition(s).attr("transform",(function(e){return"translate("+e.x+","+e.y+")"}))}(this.props.graph_json)}},{key:"render",value:function(){return r.createElement("svg",{style:{height:"100%",width:"100%"},id:"TopSVGChart_ScatterPlot",xmlns:"http://www.w3.org/2000/svg"},r.createElement("g",{transform:"translate("+this.props.x+","+this.props.y+")",style:{height:this.props.height+"px",width:this.props.width+"px"},id:this.TAB},r.createElement("g",{id:"ScatterPlot_sub"},r.createElement("g",{className:"nodes"}))))}}]),n}(r.Component),oe=b.a.Option,ie=(n(21),function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onSelectNodeChange=r.onSelectNodeChange.bind(Object(l.a)(r)),r.onColorEncodeChange=r.onColorEncodeChange.bind(Object(l.a)(r)),r.onEmbeddingLayerChange=r.onEmbeddingLayerChange.bind(Object(l.a)(r)),r.state={select_node:0,color_encode:2,embeddinglayer:1},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){}},{key:"onSelectNodeChange",value:function(e){this.setState({select_node:e})}},{key:"onColorEncodeChange",value:function(e){this.setState({color_encode:e})}},{key:"onEmbeddingLayerChange",value:function(e){console.log("onembeddinglayerchange"),this.setState({embeddinglayer:e})}},{key:"getAccuracy",value:function(e,t,n){for(var r=0,a=0;a<e.length;a++){t[e[a]]!==n[e[a]]&&(r+=1)}return 1-r/e.length}},{key:"getMisclassified",value:function(e){for(var t=[],n=e.graph_target,r=e.graph_out,a=n.node_features.length,o=0;o<a;o++){var i=n.node_features[o],s=r.node_features[o];i!==s&&t.push([o,i,s])}var c=1-t.length/a,l=e.mask,u=n.node_features,h=r.node_features;return{overall_accuracy:c,train_accuracy:this.getAccuracy(l.train,u,h),test_accuracy:this.getAccuracy(l.test,u,h),valid_accuracy:this.getAccuracy(l.valid,u,h),Misclassified:t}}},{key:"constructScatterPlotJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"input",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],c=s.join("_"),l=e.name+"_"+e.dataset_id+"_"+e.model+"_"+e.explain_id+"_"+e.graph+"_"+e.data_type_id+"_"+i+"_"+n+"_"+r+"_SELECTED_"+c+"_SELECTED_END_",u=(e.graph_in,e.graph_target),h=e.graph_out,d=e.graph_explaination,f=d.type;if("MessagePassing"!==f)return console.log("Unsupported explaination type , ",f),{success:!1};if(0===s.length)return{success:!1};var p=e.embedding,g=p[t];function v(e){if(0===e.length)return{xmin:0,xmax:0,ymin:0,ymax:0};for(var t=e[0][0],n=e[0][0],r=e[0][1],a=e[0][1],o=0;o<e.length;o++){var i=e[o][0],s=e[o][1];t>i&&(t=i),n<i&&(n=i),r>s&&(r=s),a<s&&(a=s)}return{xmin:t,xmax:n,ymin:r,ymax:a}}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;if(0===e.length)return e;var o=v(e);e.length>=100&&(r=a);for(var i=t-2*r,s=n-2*r,c=o.xmax-o.xmin,l=o.ymax-o.ymin,u=Math.min(i/c,s/l),h=r+(i-u*c)/2,d=r+(s-u*l)/2,f=o.xmin,p=o.ymin,g=[],_=0;_<e.length;_++){var m=e[_][0],y=e[_][1],x=h+(m-f)*u,b=d+(y-p)*u;g.push([x,b])}return g}var m=e.data_type_id;e.task;if(g=_(g,n,r,a,o),2==m){for(var y=u.node_features.length,x=[],b=0;b<y;b++){var w=u.node_features[b];2===i?w=u.node_features[b]:3===i?w=h.node_features[b]:5===i&&(w=u.node_features[b]===h.node_features[b]);var C=A(w,i);s.indexOf(b)>=0||(C="#ddd");var E={id:b,group:w,color:C,x:g[b][0],y:g[b][1]};x.push(E)}var S={success:!0,name:l,nodes:x,nodenum:y};return S}return console.log("Unknown data type : ",m),{success:!1}}},{key:"render",value:function(){var e=this,t=this.props,n=t.graph_object,a=(t.model,t.modelList,t.width),o=t.height,i=t.specificNodeIdList,s=o,c=a,l=o+"px";this.getMisclassified(n);var u,h,d,f=n.graph_explaination.type;n.graph_target,n.graph_out,this.state.select_node;if("MessagePassing"==f){n.graph_target.node_features.length;return r.createElement("div",null,r.createElement("div",{className:"ViewTitle"},"Embedding View"),r.createElement("div",{className:"ViewBox"},"Select Embedding Layer:",(u=[[1,"Input Layer"],[2,"Hidden Layer"],[3,"Output Layer"]],h=this.state.embeddinglayer,d=this.onEmbeddingLayerChange,r.createElement(b.a,{placeholder:"Select a embedding layer",value:h,style:{width:"200px"},onChange:d},u.map((function(e){return r.createElement(oe,{key:e[0],value:e[0]},e[1])})))),"Select Color Encode:",function(e,t,n){return r.createElement(b.a,{placeholder:"Select a color",value:t,style:{width:"200px"},onChange:n},e.map((function(e){return r.createElement(oe,{key:e[0],value:e[0]},e[1])})))}([[2,"Ground Truth"],[3,"Model Output"],[5,"True / False"]],this.state.color_encode,this.onColorEncodeChange),r.createElement("div",{style:{height:l,width:"100%",borderTop:".6px solid rgba(0,0,0, 0.4)"}},function(t){console.log("embeddinglayer",t);c*=2,s*=2;var l=e.constructScatterPlotJson(n,["","input","hidden","output"][t],c,s,30,30,e.state.color_encode,i);return l.success?1===t?r.createElement(ae,{x:0,y:0,width:a,height:o,graph_json:l,id:1,caption:"Input Layer"}," "):2===t?r.createElement(ae,{x:0,y:0,width:a,height:o,graph_json:l,id:2,caption:"Hidden Layer"}," "):3===t?r.createElement(ae,{x:0,y:0,width:a,height:o,graph_json:l,id:3,caption:"Output Layer"}," "):r.createElement("div",null):r.createElement("div",null)}(this.state.embeddinglayer))))}return r.createElement("div",null,"Please choose message passing explanation method.")}}]),n}(r.Component)),se=(Object(Y.b)((function(e){return{specificNodeIdList:e.specificNodeIdList}}),(function(e){return{}}))(ie),n(109),n(21)),ce=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).TAB="Matrix_",r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){e.feature_matrix_json.name===this.props.feature_matrix_json.name&&e.MatrixFilters.refreshnumber===this.props.MatrixFilters.refreshnumber&&e.MatrixRowFilters.refreshnumber===this.props.MatrixRowFilters.refreshnumber||this.renderD3()}},{key:"renderD3",value:function(){var e=this.props.feature_matrix_json,t=this.props.layout_config,n=e.showSource,r=0,a=30,o=100,i=0,s=t.width-i-a,c=e.y_axis,l=e.x_axis,u=e.matrix,h=e.type,d=e.color_info,f=this.props.MatrixFilters,p=this.props.MatrixRowFilters;function g(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t[e[r]]);return n}var v=Math.max(1,Math.floor(s/15));f.hasOwnProperty("index")||(f.index=[0,v]),f.index[1]-f.index[0]>=v&&(f.index[1]=f.index[0]+v);var _=d.y_axis_color;p.hasOwnProperty("row_index")&&n?(l=l.slice(f.index[0],f.index[1]),c=g(p.row_index,c),_=g(p.row_index,_),u=function(e,t,n){for(var r=[],a=new Set(n),o={},i=0;i<n.length;i++)o[n[i]]=i;for(var s=0;s<e.length;s++)if(e[s].x>=t[0]&&e[s].x<t[1]){var c=e[s].y;a.has(c)&&r.push({x:e[s].x-t[0],y:o[c],value:e[s].value})}return r}(u,f.index,p.row_index)):(l=l.slice(f.index[0],f.index[1]),u=function(e,t){for(var n=[],r=0;r<e.length;r++)e[r].x>=t[0]&&e[r].x<t[1]&&n.push({x:e[r].x-t[0],y:e[r].y,value:e[r].value});return n}(u,f.index)),n||c.length===_.length||(c=[],l=[],u=[]);var m,y,x=Math.floor(s/v),b=x*c.length+20;1===e.distance_select&&"discrete"===h?(m=2,y=["#ffffd9","#081d58"]):(m=9,y=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]);var w,C=function(){for(var e=[],t=0;t<l.length;t++)for(var n=0;n<c.length;n++)e.push({x:t,y:n,value:0});return e}();w="discrete"===h?C.concat(u):u;var E=se.max(w,(function(e){return e.value})),S=se.min(w,(function(e){return e.value})),M=se.select("#FeatureMatrix_"+this.props.id).attr("width",s+i+a).attr("height",b+r+o).attr("transform","translate("+t.x+","+t.y+")").select("#Matrix").attr("transform","translate("+i+","+r+")");n&&(c=[]);var N=M.selectAll(".y_axisLabel").data(c,(function(e){return e})),k=Math.min(5,x/4),L=2*-k-.3,I=2*k,P=N.enter().append("g").attr("class","y_axisLabel");P.merge(N).attr("transform",(function(e,t){return"translate("+L+","+(t*x+I)+")"})),N.exit().remove();var O,j,D,A,G,T,R;d.enable_y_axis_color&&function(){var e=d.y_axis_color;O=[{index:0,value:1/3},{index:1,value:1/3},{index:2,value:1/3}],j=se.pie().startAngle(-60/180*Math.PI).endAngle((2-60/180)*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index})),D=j(O),A=P.append("circle").attr("class","outer_circle"),G=N.select("circle.outer_circle"),A.merge(G).attr("r",(function(e){return 2*k})).attr("fill",(function(t,n){return e[n][4]}));for(var t=[],n=function(n){var r=P.append("path").attr("class","arc_"+n),a=N.select("path.arc_"+n),o=r.merge(a);o.style("fill",(function(t,r){return e[r][n+1]})).attr("d",(function(e){return function(e){return se.arc().innerRadius(e).outerRadius(2*e)}(k)(D[n])})),t.push(o)},r=0;r<3;r++)n(r);T=P.append("circle").attr("class","inner_circle"),R=N.select("circle.inner_circle"),T.merge(R).attr("r",(function(e){return k-.3})).attr("fill",(function(t,n){return e[n][0]}))}();P.append("text").merge(N.select("text")).text((function(e){return e})).style("text-anchor","end").style("font-size","9pt").style("font-family","Consolas, courier").style("fill","#000").style("dominant-baseline","central").attr("transform","translate("+L+",0)").attr("class","y-axis");var F=M.selectAll(".x_axisLabel").data(l,(function(e){return e})),V=F.enter().append("g").attr("class","x_axisLabel");V.merge(F).attr("transform",(function(e,t){return"translate("+t*x+",0)"})),F.exit().remove();V.append("text").merge(F.select("text")).text((function(e){return e})).style("text-anchor","begin").style("font-size","9pt").style("font-family","Consolas, courier").style("fill","#000").attr("transform","translate("+.25*x+", -2)rotate(-45)").attr("class","x-axis");for(var H=[],U=(E-S)/(m-1),W=0;W<m;W++)H.push(W*U+S);se.scaleLinear().domain(H).range(y);var z=M.selectAll(".hour").data(w,(function(e){return e.x+":"+e.y}));z.enter().append("rect").attr("class","hour bordered").merge(z).attr("x",(function(e){return e.x*x})).attr("y",(function(e){return e.y*x})).attr("rx",4).attr("ry",4).attr("width",x).attr("height",x).attr("opacity",(function(e){return e.value})).style("fill",(function(e){return t=e.value,n=e.y,t>0?_[n][0]:y[0];var t,n})).on("mouseover",(function(e){return B.style("visibility","visible").text(e.value.toFixed(4))})).on("mousemove",(function(e){return B.style("top",se.event.pageY-10+"px").style("left",se.event.pageX+10+"px")})).on("mouseout",(function(e){return B.style("visibility","hidden")})),z.exit().remove();var B=se.select("body").select("#tooltip_matrix").style("position","absolute").style("z-index","10").style("visibility","hidden").text("a simple tooltip")}},{key:"render",value:function(){return r.createElement("g",{id:"FeatureMatrix_"+this.props.id},r.createElement("g",{id:"Matrix"}))}}]),n}(r.Component),le=Object(Y.b)((function(e){return{MatrixFilters:e.matrixFilters,MatrixRowFilters:e.matrixRowFilters}}),(function(e){return{changeMatrixFilters:function(t){return e(X(t))}}}))(ce),ue=n(21),he=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).TAB="BrushBarChart_",r.updateMatrixFilters=r.updateMatrixFilters.bind(Object(l.a)(r)),r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){e.feature_matrix_json.name!==this.props.feature_matrix_json.name&&(ue.selectAll("#"+this.TAB+this.props.id).remove(),this.renderD3())}},{key:"updateMatrixFilters",value:function(e){var t=Object.assign({},this.props.MatrixFilters);t.refreshnumber=t.refreshnumber+1,t.index=e.index,this.props.changeMatrixFilters(t)}},{key:"renderD3",value:function(){var e,t,n,r,a,o,i=this.props.feature_matrix_json.selectedFeatureStatistics,s=this.props.layout_config,c=ue.select("#chart_"+this.props.id).append("g").attr("id",this.TAB+this.props.id).attr("width",s.width).attr("height",s.height).attr("transform","translate("+s.x+","+s.y+")"),l=20,u=30,h=0,d=0,f=+s.width-d-u,p=+s.height-l-h,g=this.props.layout_config.max_row_num_block,v=ue.scaleBand().range([0,f]).padding(.1),_=ue.scaleBand().range([0,f]).padding(.1),m=ue.scaleLinear().range([p,0]),y=ue.scaleLinear().range([p,0]);t=i.map((function(e,t){return{id:t,ratio:e}})),n=[].concat(t),r=n.length;var x=this.updateMatrixFilters;e=ue.brushX().extent([[0,0],[f,p]]).on("brush end",(function(){if(!ue.event.sourceEvent||"zoom"!==ue.event.sourceEvent.type){var t,i,s=ue.event.selection||_.range();o=[Math.round(s[0]/(f/r)),Math.round(s[1]/(f/r))],v.domain(n.slice(o[0],o[1]).map((function(e){return e.id}))),o[1]-o[0]>=g+1?(o[1]=o[0]+g,ue.select(this).call(e.move,o.map((function(e){return e*f/r})))):(t=o[0],i=o[1],a.selectAll(".bar").style("fill-opacity",(function(e,n){return n>=t&&n<i?"1":"0.3"})),x({index:[o[0],o[1]]}))}})),a=c.append("g").attr("class","context").attr("transform","translate("+d+","+l+")"),v.domain(n.map((function(e){return e.id}))),m.domain([0,ue.max(n,(function(e){return e.ratio}))]),_.domain(v.domain()),y.domain(m.domain()),function(){var e=a.selectAll(".bar").data(n);e.attr("x",(function(e){return _(e.id)})).attr("width",_.bandwidth()).attr("y",(function(e){return y(e.ratio)})).attr("height",(function(e){return p-y(e.ratio)})).style("fill",(function(e){return"steelblue"})),e.enter().insert("rect").attr("class","bar").attr("x",(function(e){return _(e.id)})).attr("width",_.bandwidth()).attr("y",(function(e){return y(e.ratio)})).attr("height",(function(e){return p-y(e.ratio)})).style("fill",(function(e){return"steelblue"})),e.exit().remove()}(),a.append("g").attr("class","brush").call(e).call(e.move,_.range())}},{key:"render",value:function(){return r.createElement("g",{id:"chart_"+this.props.id})}}]),n}(r.Component),de=Object(Y.b)((function(e){return{MatrixFilters:e.matrixFilters}}),(function(e){return{changeMatrixFilters:function(t){return e(X(t))}}}))(he),fe=(n(212),n(21)),pe=fe.tree,ge=fe.hierarchy,ve=fe.select,_e=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).TAB="IndentedTree_",r.updateMatrixFilters=r.updateMatrixFilters.bind(Object(l.a)(r)),r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){e.feature_matrix_json.name!==this.props.feature_matrix_json.name&&(fe.selectAll("#IndentedTree").remove(),this.renderD3())}},{key:"updateMatrixFilters",value:function(e){var t=Object.assign({},this.props.MatrixRowFilters);t.refreshnumber=t.refreshnumber+1,t.row_index=e,this.props.changeMatrixRowFilters(t)}},{key:"renderD3",value:function(){var e=this.props.feature_matrix_json.indentedTree;new me(e,this.props.layout_config,this.updateMatrixFilters)}},{key:"render",value:function(){return r.createElement("g",{id:"hierarchy-container"})}}]),n}(r.Component),me=function(){function e(t,n,r){var a=this;Object(s.a)(this,e),this.margin=void 0,this.width=void 0,this.height=void 0,this.barHeight=void 0,this.barWidth=void 0,this.i=void 0,this.duration=void 0,this.tree=void 0,this.root=void 0,this.svg=void 0,this.updateMatrixFilters=void 0,this.connector=function(e){return"M"+e.parent.y+","+e.parent.x+"V"+e.x+"H"+e.y},this.collapse=function(e){e.children&&(e._children=e.children,e._children.forEach(a.collapse),e.children=null)},this.click=function(e){e.children?(e._children=e.children,e.children=null):(e.children=e._children,e._children=null),a.update(e)},this.getRowIdList=function(e){return e.map((function(e){return e.data.row_id}))},this.increI=function(){return a.i=a.i+1,a.i},this.update=function(e){a.width=800;var t=a.tree(a.root),n=Math.min(5,a.barHeight/4),r=[];t.eachBefore((function(e){r.push(e)})),a.updateMatrixFilters(a.getRowIdList(r)),a.height=Math.max(500,r.length*a.barHeight+a.margin.top+a.margin.bottom);var o=r.slice(1);r.forEach((function(e,t){e.x=t*a.barHeight}));var i=a.increI,s=a.svg.selectAll("g.node").data(r,(function(e){return e.id||(e.id=i())})),c=s.enter().append("g").attr("class","node").attr("transform",(function(){return"translate("+e.y0+","+e.x0+")"})).on("click",a.click),l=fe.pie().startAngle(-60/180*Math.PI).endAngle((2-60/180)*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index}))([{index:0,value:1/3},{index:1,value:1/3},{index:2,value:1/3}]);c.append("circle").attr("class","outer_circle").attr("r",(function(e){return 2*n})).attr("fill",(function(e){return e.data.color[4]}));for(var u=[],h=function(e){var t=c.append("path").attr("class","arc_"+e).style("fill",(function(t){return t.data.color[e+1]})).attr("d",(function(t){return function(e){return fe.arc().innerRadius(e).outerRadius(2*e)}(n)(l[e])}));u.push(t)},d=0;d<3;d++)h(d);c.append("circle").attr("class","inner_circle").attr("r",(function(e){return n-.3})).attr("fill",(function(e){return e.data.color[0]})),a.barHeight;c.append("text").attr("x",(function(e){return e.children||e._children,10})).attr("dy",".35em").attr("text-anchor",(function(e){return e.children||e._children,"start"})).text((function(e){return e.data.name.length>20?e.data.name.substring(0,20)+"...":e.data.name})).style("fill-opacity",1e-6),c.append("svg:title").text((function(e){return e.data.name}));var f=s.merge(c);f.attr("transform",(function(e){return"translate("+e.y+","+e.x+")"})),f.select("text").style("fill-opacity",1),s.exit().remove();var p=a.svg.selectAll("path.link").data(o,(function(e){return e.id+"->"+e.parent.id})),g=p.enter().insert("path","g").attr("class","link");p.merge(g).attr("d",a.connector),p.exit().remove(),r.forEach((function(e){e.x0=e.x,e.y0=e.y}))},this.margin={top:10,right:10,bottom:20,left:10},this.width=n.width-this.margin.right-this.margin.left,this.height=n.width-this.margin.top-this.margin.bottom,this.barHeight=n.barHeight,this.barWidth=.8*this.width,this.i=0,this.duration=0,this.tree=pe().size([this.width,this.height]),this.updateMatrixFilters=r,this.tree=pe().nodeSize([0,30]),this.root=this.tree(ge(t)),this.root.each((function(e){e.name=e.id,e.id=a.i,a.i++})),this.root.x0=this.root.x,this.root.y0=this.root.y,this.svg=ve("#hierarchy-container").attr("width",this.width+this.margin.right+this.margin.left).attr("height",this.height+this.margin.top+this.margin.bottom).attr("transform","translate("+n.x+","+n.y+")").append("g").attr("id","IndentedTree").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.update(this.root)}return Object(c.a)(e,[{key:"$onInit",value:function(){}}]),e}(),ye=Object(Y.b)((function(e){return{MatrixRowFilters:e.matrixRowFilters}}),(function(e){return{changeMatrixRowFilters:function(t){return e(function(e){return{type:"MATRIX_ROW_FILTERS_CHANGE",matrixRowFilters:e}}(t))}}}))(_e),xe=n(266),be=(b.a.Option,function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onAxisChange=r.onAxisChange.bind(Object(l.a)(r)),r.onDistanceChange=r.onDistanceChange.bind(Object(l.a)(r)),r.onDataSourceChange=r.onDataSourceChange.bind(Object(l.a)(r)),r.onColorEncodeChange=r.onColorEncodeChange.bind(Object(l.a)(r)),r.onEnableSort=r.onEnableSort.bind(Object(l.a)(r)),r.state={axis_select:2,distance_select:1,dataSource_select:1,color_encode:2,enableSorting:!0},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){}},{key:"constructFeatureMatrixJson",value:function(e,t,n,r,a,o,i,s,c,l,u,h){var d,f=t.join("_"),p=e,g=e;p=e.common,g=e.individual,d=p.name+"_"+p.dataset_id+"_"+p.data_type_id+"_SELECTED_"+f+"_SELECTED_END_"+n+"_"+r+"_"+a+"_"+o+"_"+i+"_"+c+"_"+l+"_"+u,s&&(d=d+"_"+h);var v=p.graph_in,_=p.graph_target,m=g.GCN.graph_out,y=p.graph_explaination.type;if("MessagePassing"!==y)return console.log("Unsupported explaination type , ",y),{success:!1};if(0===t.length)return{success:!1};g.GCN.model_state_dict;var x=V(g.GCN.message_passing),b=new Set(p.mask.train);function w(e){var t=_.node_features[e],n=g.GCN.graph_out.node_features[e],r=g.MLP.graph_out.node_features[e],a=g.GCN_Identity_features.graph_out.node_features[e];return[A(t,2),A(n,3),A(r,3),A(a,3),H(e,b)]}var C,E={};s&&(t=function e(t){var n=[];n.push(parseInt(t.name));for(var r=0;r<t.children.length;r++)n=n.concat(e(t.children[r]));return n}(E=function e(t,n,r,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(r>=a)return{name:""+n,children:[],row_id:o,next_row_id:o+1,edge_weight:i,color:w(n)};for(var s=Object.keys(t[n]),c=[],l=o,u=o+1,h=0;h<s.length;h++){var d=parseInt(s[h]),f=t[n][d],p=e(t,d,r+1,a,u,f);u=p.next_row_id,c.push(p)}return{name:""+n,children:c,row_id:l,next_row_id:u,edge_weight:i,color:w(n)}}(x,i,0,h-1,0)));var S=[],M=[],N=[];1===a?(C=v.feature,S=v.feature_value):2===a?C=m.hidden_vector:3===a&&(C=m.output_vector);var k=[],L=[],I=[],P=r;function O(e,t){for(var n=e.length,r=t.length,a=0,o=0;o<n;o++)t.indexOf(e[o])>=0&&(a+=1);return n+r-2*a}function j(e,t){for(var n=e.length,r=0,a=0;a<n;a++)r+=(e[a]-t[a])*(e[a]-t[a]);return r=Math.sqrt(r)}var D=[],G=[],T=[];if(!(t.length>0&&t.length<=1e3))return{success:!1};if(2===P)for(var R=0;R<t.length;R++)for(var F=t[R],U=0;U<t.length;U++){var W=t[U],z=C[F],B=C[W],J=void 0;J=1===a?O(z,B):j(z,B),console.log("Distance",J);var Y;Y={x:R,y:U,value:J},k.push(Y)}else{if(1===a){for(var X=[],q=[],Z=0;Z<t.length;Z++)for(var K=t[Z],$=0;$<C[K].length;$++){var Q=C[K][$];X.indexOf(Q)>=0||(X.push(Q),q.push(0));var ee=X.indexOf(Q);q[ee]=q[ee]+1}if(c){var te=q.map((function(e,t){return{index:X[t],value:e}}));te.sort((function(e,t){return e.value>t.value?-1:1})),X=te.map((function(e){return e.index})),q=te.map((function(e){return e.value}))}L=X,I=q;for(var ne=0;ne<t.length;ne++)for(var re=t[ne],ae=0;ae<C[re].length;ae++){var oe=C[re][ae],ie=L.indexOf(oe),se=ne,ce=S[re][ae],le=void 0;le=1===n?{x:se,y:ie,value:ce}:{x:ie,y:se,value:ce},k.push(le)}}else for(var ue=0;ue<t.length;ue++)for(var he=t[ue],de=0;de<C[he].length;de++){var fe=de;L.indexOf(fe)>=0||L.push(fe);var pe=de,ge=ue,ve=void 0,_e=C[he][de];ve=1===n?{x:ge,y:pe,value:_e}:{x:pe,y:ge,value:_e},k.push(ve)}if(M.length>0&&N.length>0){(G=L.slice()).push("Bias");for(var me=0;me<M[0].length;me++){T.push(me);for(var ye=0;ye<G.length;ye++){var xe=me,be=ye,we=void 0;we=be<G.length-1?M[ye][me]:N[me];var Ce=void 0;Ce=1===n?{x:xe,y:be,value:we}:{x:be,y:xe,value:we},D.push(Ce)}}}}for(var Ee=[],Se=0;Se<t.length;Se++){var Me=w(t[Se]);Ee.push(Me)}var Ne=p.data_type_id;if(2===Ne){var ke=p.graph_additional_info,Le=[];if(Object.keys(ke).indexOf("idx_to_attr")>=0&&1===a)for(var Ie=ke.idx_to_attr,Pe=0;Pe<L.length;Pe++)Le.push(Ie[L[Pe]]);else Le=L;var Oe,je,De,Ae={};if(1===P)if(1===a||2===a){var Ge=[],Te=[];1===n?(Ge=T,Te=G):(Ge=G,Te=T);Ae={success:!0,name:d,matrix:D,x_axis:Ge,y_axis:Te,distance_select:r,type:"continuous",color_info:{enable_x_axis_color:!1,enable_y_axis_color:!1,x_axis_color:[],y_axis_color:[]}}}else Ae={success:!1};else Ae={success:!1};Oe=1===a?"discrete":"continuous";var Re=!1,Fe=!1,Ve=[],He=[];2===P?(je=t,De=t,Re=!0,Fe=!0,Ve=Ee,He=Ee):1===n?(je=t,De=Le,Re=!0,Fe=!1,Ve=Ee,He=[]):(je=Le,De=t,Re=!1,Fe=!0,Ve=[],He=Ee);var Ue={};return Ue.enable_x_axis_color=Re,Ue.enable_y_axis_color=Fe,Ue.x_axis_color=Ve,Ue.y_axis_color=He,{success:!0,name:d,matrix:k,x_axis:je,y_axis:De,distance_select:r,type:Oe,color_info:Ue,selectedFeatureStatistics:I,indentedTree:E,filter_graph_json:Ae,showSource:s}}return console.log("Unknown data type : ",Ne),{success:!1}}},{key:"onAxisChange",value:function(e){this.setState({axis_select:e})}},{key:"onDistanceChange",value:function(e){this.setState({distance_select:e})}},{key:"onDataSourceChange",value:function(e){this.setState({dataSource_select:e})}},{key:"onColorEncodeChange",value:function(e){this.setState({color_encode:e})}},{key:"onEnableSort",value:function(e){this.setState({enableSorting:e})}},{key:"render",value:function(){var e=this,t=this.props,n=t.graph_object,a=t.specificNodeIdList,o=n.common.graph_explaination.type,i=this.constructFeatureMatrixJson(n,a,this.state.axis_select,this.state.distance_select,this.state.dataSource_select,this.state.color_encode,this.props.select_inspect_node,this.props.showSource,this.state.enableSorting,this.props.width,this.props.height,this.props.extendedMode);if("MessagePassing"==o&&i.success){var s=120;this.props.showSource||(s=60);var c=this.props.width-s-30,l=Math.max(1,Math.floor(c/15)),u=Math.floor(c/l),h=u,d=180+i.y_axis.length*h+20,f={width:this.props.width-s,height:100,x:s,y:0,max_row_num_block:l},p={width:this.props.width-s,height:d-180,x:s,y:180,gridSize:u,max_row_num_block:l},g={width:s,height:d-180,x:0,y:180,barHeight:h};return r.createElement("div",null,r.createElement("div",{className:"ViewTitle"},"Feature Matrix View",r.createElement("div",{style:{float:"right"}})),r.createElement("div",{className:"ViewBox",style:{width:"100%",height:this.props.height-40+"px",overflowX:"scroll"}},r.createElement("div",{style:{width:"100%"}},r.createElement("div",{style:{width:"100%",height:d+"px"}},r.createElement("svg",{style:{height:"100%",width:"100%"},id:"FeatureMatrixSVGChart",xmlns:"http://www.w3.org/2000/svg"},r.createElement("foreignObject",{x:f.x-50,y:"20",width:"50",height:"40"},r.createElement("div",null,r.createElement(xe.a,{checked:this.state.enableSorting,onChange:function(t){console.log(t),e.onEnableSort(t)}}))),r.createElement(de,{id:3,feature_matrix_json:i,layout_config:f}),r.createElement(le,{id:1,feature_matrix_json:i,layout_config:p}),this.props.showSource?r.createElement(ye,{id:4,feature_matrix_json:i,layout_config:g}):r.createElement("g",null))))))}return r.createElement("div",{style:{width:"100%",height:this.props.height-20+"px",overflowX:"scroll"}},r.createElement("div",{className:"ViewTitle"},"Feature Matrix View"))}}]),n}(r.Component)),we=Object(Y.b)((function(e){return{specificNodeIdList:e.specificNodeIdList,showSource:e.showSource,select_inspect_node:e.select_inspect_node,extendedMode:e.extendedMode}}),(function(e){return{}}))(be),Ce=(n(214),n(272)),Ee=n(94),Se=n.n(Ee),Me=window.location.origin,Ne=(Se.a.create({baseURL:"".concat(Me,"/api/"),headers:{"Access-Control-Allow-Origin":"*"}}),window.location.origin),ke=Se.a.create({baseURL:"".concat(Ne,"/data/"),headers:{"Access-Control-Allow-Origin":"*"}});function Le(){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(_.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="/datasets",t="/datasetlist_V1_2.json",e.next=4,ke.get(t);case 4:if(200!==(n=e.sent).status){e.next=7;break}return e.abrupt("return",n.data);case 7:throw n;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(e){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(_.a)(v.a.mark((function e(t){var n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/explainMethods",n={model_id:t},e.next=4,ke.get("/explainMethods",{params:n});case 4:if(200!==(r=e.sent).status){e.next=7;break}return e.abrupt("return",r.data);case 7:throw r;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){return De.apply(this,arguments)}function De(){return(De=Object(_.a)(v.a.mark((function e(t){var n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/models",n={dataset_id:t},e.next=4,ke.get("/models",{params:n});case 4:if(200!==(r=e.sent).status){e.next=7;break}return e.abrupt("return",r.data);case 7:throw r;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e){return Ge.apply(this,arguments)}function Ge(){return(Ge=Object(_.a)(v.a.mark((function e(t){var n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/graphs",n={dataset_id:t},e.next=4,ke.get("/graphs",{params:n});case 4:if(200!==(r=e.sent).status){e.next=7;break}return e.abrupt("return",r.data);case 7:throw r;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,t,n,r){return Re.apply(this,arguments)}function Re(){return(Re=Object(_.a)(v.a.mark((function e(t,n,r,a){var o,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/graph_info",o={dataset_id:t,model_id:n,explain_id:r,graph_id:a},e.next=4,ke.get("/graph_info",{params:o});case 4:if(200!==(i=e.sent).status){e.next=7;break}return e.abrupt("return",i.data);case 7:throw i;case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e){return Ve.apply(this,arguments)}function Ve(){return(Ve=Object(_.a)(v.a.mark((function e(t){var n,r,a,o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="/cache_bundle_"+t+"_V1_2.json",e.next=4,ke.get(n);case 4:if(200!==(r=e.sent).status){e.next=7;break}return e.abrupt("return",r.data);case 7:throw r;case 10:return"/graph_bundle_info",a={dataset_id:t},e.next=14,ke.get("/graph_bundle_info",{params:a});case 14:if(200!==(o=e.sent).status){e.next=17;break}return e.abrupt("return",o.data);case 17:throw o;case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var He=b.a.Option,Ue=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onModelSelectorChange=r.onModelSelectorChange.bind(Object(l.a)(r)),r.onDatasetSelectorChange=r.onDatasetSelectorChange.bind(Object(l.a)(r)),r.onExplainMethodSelectorChange=r.onExplainMethodSelectorChange.bind(Object(l.a)(r)),r.onGraphSelectorChange=r.onGraphSelectorChange.bind(Object(l.a)(r)),r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.initDatasetList()}},{key:"initDatasetList",value:function(){var e=Object(_.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le();case 2:!0===(t=e.sent).success&&this.props.initDatasetList(t.datasets);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"initModelList",value:function(){var e=Object(_.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,je(t);case 2:!0===(n=e.sent).success&&this.props.initModelList(n.models);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initExplainList",value:function(){var e=Object(_.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Pe(t);case 2:!0===(n=e.sent).success&&this.props.initExplainList(n.explainMethods);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"initGraphList",value:function(){var e=Object(_.a)(v.a.mark((function e(t){var n,r,a,o,i;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return e.next=3,Ae(t);case 3:if(!0===(n=e.sent).success){for(r=[],a=n.graphs,o=0;o<a.length;o++)i={key:a[o][0],graphno:a[o][0],name:a[o][1]},r.push(i);this.props.initGraphList(r)}case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onModelSelectorChange",value:function(e){this.props.changeModel(e),this.props.changeExplainMethod(null),this.initExplainList(e)}},{key:"onDatasetSelectorChange",value:function(e){this.props.changeDataset(e),this.props.clearIdInfo()}},{key:"onExplainMethodSelectorChange",value:function(e){this.props.changeExplainMethod(e)}},{key:"onGraphSelectorChange",value:function(e){this.props.clearIdInfo(),this.props.changeGraph(e)}},{key:"render",value:function(){var e=this.props.datasetList.length<=0;return r.createElement(Ce.a,null,"Datasets:\xa0",r.createElement(b.a,{placeholder:"Select a dataset",value:this.props.dataset_id||void 0,style:{width:"200px"},onChange:this.onDatasetSelectorChange,disabled:e},this.props.datasetList.map((function(e){return r.createElement(He,{value:e.id,key:e.id},e.name)}))))}}]),n}(r.Component),We=Object(Y.b)((function(e){return{model_id:e.model,graph_id:e.graph,dataset_id:e.dataset_id,explain_id:e.explain_id,modelList:e.modelList,datasetList:e.datasetList,explainList:e.explainList,graphList:e.graphList}}),(function(e){return{changeModel:function(t){return e(function(e){return{type:"MODEL_CHANGE",model:e}}(t))},changeDataset:function(t){return e(function(e){return{type:"DATASET_ID_CHANGE",dataset_id:e}}(t))},changeExplainMethod:function(t){return e(function(e){return{type:"EXPLAIN_METHOD_ID_CHANGE",explain_id:e}}(t))},changeGraph:function(t){return e(function(e){return{type:"GRAPH_CHANGE",graph:e}}(t))},clearIdInfo:function(){return e({type:"CLEAR_ID_INFO"})},initModelList:function(t){return e(function(e){return{type:"INIT_MODEL_LIST",modelList:e}}(t))},initDatasetList:function(t){return e(function(e){return{type:"INIT_DATASET_LIST",datasetList:e}}(t))},initExplainList:function(t){return e(function(e){return{type:"INIT_EXPLAIN_LIST",explainList:e}}(t))},initGraphList:function(t){return e(function(e){return{type:"INIT_GRAPH_LIST",graphList:e}}(t))}}}))(Ue),ze=ee.a.Group,Be=["Train","Valid","Test","Others"],Je=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"render",value:function(){return r.createElement("div",null,r.createElement("div",{className:"ViewTitle"},"Control Panel"),r.createElement("div",{className:"ViewBox"},r.createElement(Ce.a,null,r.createElement(We,null)),this.props.dataset_id&&this.props.dataset_id>=0?r.createElement(Ce.a,null,"Inspect category:\xa0\xa0",r.createElement(ze,{value:this.props.InspectCategoryList,onChange:this.props.onChangeInspectCategoryList},Be.map((function(e,t){return r.createElement(ee.a,{key:e,value:e},e)})))):r.createElement("div",null)))}}]),n}(r.Component),Ye=Object(Y.b)((function(e){return{InspectCategoryList:e.InspectCategoryList,dataset_id:e.dataset_id}}),(function(e){return{onChangeInspectCategoryList:function(t){return e({type:"INSPECT_CATEGORY_LIST_CHANGE",inspectCategoryList:t})}}}))(Je),Xe=(n(235),n(21)),qe=(n(236),function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).onRibbonClick=r.onRibbonClick.bind(Object(l.a)(r)),r.clearFilter=r.clearFilter.bind(Object(l.a)(r)),r.onCategoryClick=r.onCategoryClick.bind(Object(l.a)(r)),r.state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){e.PSJson.name!==this.props.PSJson.name&&(Xe.selectAll("#ParallelSets_SVG").remove(),this.props.changeFilters({}),this.renderD3())}},{key:"onRibbonClick",value:function(e){for(var t={},n=e.data;n&&n.hasOwnProperty("parent");)t[n.dimension]=[n.name],n=n.parent;this.props.changeFilters(t)}},{key:"onCategoryClick",value:function(e){console.log("onCategoryClick",e);var t={},n=e.data;t[n.dimension.name]=[n.name],this.props.changeFilters(t)}},{key:"clearFilter",value:function(){console.log("clearFilter"),this.props.changeFilters({})}},{key:"renderD3",value:function(){var e=this.props,t=e.width,n=e.height,r=e.PSJson.PSData,a=r.columns,o=Xe.parsets().dimensions(a).width(t).height(n).tension(1).on("ribbonClick",this.onRibbonClick).on("sortDimensions",this.clearFilter).on("sortCategories",this.clearFilter).on("categoryClick",this.onCategoryClick),i=r;Xe.select("#parallelSets").append("svg").attr("id","ParallelSets_SVG").attr("width",o.width()).attr("height",o.height()).datum(i).call(o)}},{key:"render",value:function(){return r.createElement("div",{id:"parallelSets"})}}]),n}(r.Component)),Ze=Object(Y.b)((function(e){return{}}),(function(e){return{changeFilters:function(t){return e(function(e){return{type:"FILTERS_CHANGE",filters:e}}(t))}}}))(qe),Ke=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return r.createElement(w.a,null," ",U(this.props.PSSelectedNodes,this.props.totalNodeNum))}}]),n}(r.Component),$e=Object(Y.b)((function(e){return{PSSelectedNodes:e.PSSelectedNodes}}),(function(e){return{}}))(Ke),Qe=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"componentDidUpdate",value:function(e,t){}},{key:"getSimilarityFeatureSet",value:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5;function i(e,t,n,r){for(var a=e.length,o=n.length,i=0,s=0,c=0,l=0;l<a;l++){var u=n.indexOf(e[l]);u>=0&&(i+=t[l]*r[u]),s+=t[l]*t[l]}for(var h=0;h<o;h++)c+=r[h]*r[h];(s=Math.sqrt(s))<1e-8&&(s=1e-8),(c=Math.sqrt(c))<1e-8&&(c=1e-8);var d=i/(s*c);return d>=1?d=1:d<0&&(d=0),d}for(var s={},c=0;c<e.length;c++){for(var l=0,u=[],h=[],d=0;d<t.length;d++){var f=e[c],p=t[d],g=i(n[f],r[f],n[p],r[p]);g>l?(l=g,u=[t[d]]):g===l&&u.push(t[d]),h.push({anchor_id:p,anchor_label:a[p],anchor_similarity:g})}var v=(h=h.sort((function(e,t){return e.anchor_similarity>t.anchor_similarity?-1:1}))).slice(0,o);s[""+e[c]]={feature_similarity:l,feature_sim_set:u,topk_anchor_similarity_list:v}}return s}},{key:"getShortestPathDistanceSet",value:function(e,t,n,r){console.log("getShortestPathDistanceSet begin anchor_list.length",r.length);for(var a={},o=new Set(r),i=0;i<e.length;i++){var s=[];s.push([e[i],0]);for(var c="inf",l=[],u=new Array(t).fill(0);s.length>0;){var h=s.shift();if(!u[h[0]])if(u[h[0]]=1,o.has(h[0]))if("inf"===c)c=h[1],l.push(h[0]);else{if(c!==h[1])break;l.push(h[0])}else for(var d=n[h[0]],f=0;f<d.length;f++)u[d[f]]||s.push([d[f],h[1]+1])}a[""+e[i]]={shortest_path_distance:c,shortest_path_set:l}}return console.log("getShortestPathDistanceSet end"),a}},{key:"constructPSJson",value:function(e,t,n,r,a,o,i,s){var c,l,u=o.join("_"),h=e,d=e;h=e.common,d=e.individual,c=h.name+"_"+h.dataset_id+"_"+t+"_"+h.data_type_id+"_CheckedList_"+u+"_CheckedList_End_"+i+"_"+s,l=d.GCN.graph_out;var f=h.graph_in,p=h.graph_target,g=h.graph_explaination.type;if("MessagePassing"!==g)return console.log("Unsupported explaination type , ",g),{success:!1};var v=h.data_type_id;var _=F(f),y=h.mask;var x=new Set(h.mask.train);function b(e){var t=p.node_features[e],n=d.GCN.graph_out.node_features[e],r=d.MLP.graph_out.node_features[e],a=d.GCN_Identity_features.graph_out.node_features[e];return[A(t,2),A(n,3),A(r,3),A(a,3),H(e,x)]}function w(e,t){return e.active?e.end<t.start?{active:!0,start:e.start,end:t.end,count:e.count+t.count}:(console.log("invalid added"),{active:!1}):t.active?t:(console.log("inactive added"),{active:!1})}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n].start,a=t[n].end;if(e>=r&&e<=a)return t[n].name}return""+e}if(2===v){var E,S,M=p.node_features.length,N=(h.graph_additional_info.num_class,function(e,t,n){for(var r=n.train,a=n.test,o=n.valid,i=[].concat(Object(m.a)(r),Object(m.a)(a),Object(m.a)(o)),s=[],c=0;c<e;c++)i.indexOf(c)>=0||s.push(c);var l=[];return t.indexOf("Train")>=0&&(l=l.concat(r)),t.indexOf("Test")>=0&&(l=l.concat(a)),t.indexOf("Valid")>=0&&(l=l.concat(o)),t.indexOf("Others")>=0&&(l=l.concat(s)),l}(M,o,y)),k=function(e,t,n,r){for(var a,o,i,s,c,l=[],u=[],h=[],d=0;d<e;d++){var f=0,p=0,g=n[d],v=r[d],_={cgt_npt:0,cgt_ngt:0,cpt_npt:0,cpt_ngt:0};if(d in t){f=t[d].length;for(var m=0,y=0;y<f;y++){var x=t[d][y];n[x]===r[x]&&(m+=1),a=_,o=g,i=v,s=n[x],c=r[x],o===s&&(a.cgt_ngt=a.cgt_ngt+1),o===c&&(a.cgt_npt=a.cgt_npt+1),i===s&&(a.cpt_ngt=a.cpt_ngt+1),i===c&&(a.cpt_npt=a.cpt_npt+1),_=a}0===f?(p=0,_.cgt_ngt=0,_.cgt_npt=0,_.cpt_ngt=0,_.cpt_npt=0):(p=m/f,_.cgt_ngt=_.cgt_ngt/f,_.cgt_npt=_.cgt_npt/f,_.cpt_ngt=_.cpt_ngt/f,_.cpt_npt=_.cpt_npt/f)}l.push(f),u.push(p),h.push(_)}return{degree_list:l,one_hop_accuracy_list:u,cn_consistency_list:h}}(M,_,p.node_features,l.node_features);E=h.graph_additional_info.SPD,S=h.graph_additional_info.KFS;for(var L=k.degree_list,I=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=e.length,r={},a=0;a<n;a++)r[e[a]]?r[e[a]]=r[e[a]]+1:r[e[a]]=1;for(var o=Object.keys(r),i=[],s=0;s<o.length;s++)i.push(parseInt(o[s]));var c=function(e,t){return e-t};i=i.sort(c);for(var l=[],u={active:!1},h={active:!1},d=n/t,f=0;f<i.length;f++){var p={active:!0,start:i[f],end:i[f],count:r[i[f]]};(h=w(u,p)).active&&(h.count<d?f===o.length-1&&(l.push(h),h={active:!1}):h.count>=2*d?(u.active&&l.push(u),l.push(p),h={active:!1}):(l.push(h),h={active:!1}),u=Object.assign({},h))}for(var g=0;g<l.length;g++){var v=l[g].start,_=l[g].end;l[g].name=v===_?""+_:"["+v+","+_+"]"}return l}(L.slice()),P=k.one_hop_accuracy_list,O=k.cn_consistency_list,j=[],D=d.GCN.real_model_name,G=D+"_correctness",T=d.MLP.real_model_name+"_correctness",R=d.GCN_Identity_features.real_model_name+"_correctness",V=D+"_one_hop_accuracy",U=["Ground_Truth_Label",G,V,T,R,"Degree","Shortest_Path_Distance_to_Train_Nodes"],W=0,z={},B=(function(){var e=h.graph_additional_info,t=e.num_class,n=[];if(Object.keys(e).indexOf("idx_to_class")>=0)for(var r=e.idx_to_class,a=0;a<t;a++)n.push(r[a]);else for(var o=0;o<t;o++)n.push(""+o)}(),0);B<N.length;B++){var J=N[B],Y={},X=p.node_features[J],q=l.node_features[J],Z=l.output_vector[J][q],K=d.MLP.graph_out.node_features[J],$=d.GCN_Identity_features.graph_out.node_features[J];Y.Data_id=J,Y.Color=b(J),Y.Shortest_Path_Distance_to_Train_Nodes=E[J].dis,Y.Spd_node_info=E[J].train_nodes,Y.Spd_node_info[q],Y.Spd_node_info[q]>=Math.max.apply(Math,Object(m.a)(Y.Spd_node_info))&&1,Y.Topkfs_node_info=S[J].train_nodes,Y.Topkfs_nodes=S[J].details,Y.Topkfs_nodes=Y.Topkfs_nodes.sort((function(e,t){return e.anchor_label<t.anchor_label?-1:e.anchor_label>t.anchor_label?1:e.anchor_similarity>t.anchor_similarity?-1:1})),Y.CN_consistency=O[J],Y.Degree=C(L[J],I),Y.Real_Degree=L[J],Y.Ground_Truth_Label=""+X,X in z||(z[X]={correct_num:0,wrong_num:0}),Y.GCN_Prediction_Label=""+q,Y.GCN_Confidence=Z,Y["GCN(w/o_adj)_Prediction_Label"]=""+K,Y["GCN(w/o_features)_Prediction_Label"]=""+$,Y[T]=K===X?"Correct":"Wrong",Y[R]=$===X?"Correct":"Wrong",X===q?(Y[G]="Correct",W+=1,z[X].correct_num=z[X].correct_num+1):(Y[G]="Wrong",z[X].wrong_num=z[X].wrong_num+1),Y[V]=""+P[J];var Q=P[J];Q>0&&Q<1&&(Y[V]="(0,1)"),j.push(Y)}j.columns=U;for(var ee=Object.keys(z),te=0,ne=0;ne<ee.length;ne++){var re=z[ee[ne]],ae=re.correct_num+re.wrong_num;re.accuracy=ae>0?re.correct_num/ae:0,re.total=ae,ae>te&&(te=ae)}for(var oe=0;oe<ee.length;oe++){var ie=z[ee[oe]];ie.max_percentage=te>0?ie.total/te:0}return N.length<=0?(console.log("No selected data."),{success:!1}):{success:!0,name:c,PSData:j,accuracy:W/N.length,nodenum:N.length}}return console.log("Unknown data type : ",v),{success:!1}}},{key:"render",value:function(){var e=this.props,t=e.graph_object,n=e.show_mode,a=e.explained_node,o=e.onExplainNodeChange,i=e.onShowModeChange,s=this.props.width-10,c=this.props.height-60,l=this.constructPSJson(t,n,a,o,i,this.props.checkedList,s,c);return this.props.changePSJson(l),r.createElement("div",{style:{width:"100%",height:this.props.height-10+"px",overflowX:"hidden"}},r.createElement("div",{className:"ViewTitle"},"Parallel Sets View",r.createElement("div",{style:{float:"right"}},l.success?r.createElement("div",null,r.createElement("div",null," #Nodes: ",r.createElement($e,{totalNodeNum:l.nodenum}))):r.createElement("div",null))),r.createElement("div",{className:"ViewBox"},r.createElement(Ce.a,{gutter:4},r.createElement(Ce.a,null,l.success?r.createElement(Ze,{width:s,height:c,PSJson:l}):r.createElement("div",null)))))}}]),n}(r.Component),et=Object(Y.b)((function(e){return{checkedList:e.InspectCategoryList}}),(function(e){return{changePSJson:function(t){return e(function(e){return{type:"PSJSON_CHANGE",PSJson:e}}(t))}}}))(Qe),tt=(n(237),n(238),n(21)),nt=(n(239),n(240)),rt=n(246),at=(b.a.Option,function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).point_array=[],r.additional_info={},r.model={},r.mappingGraph=r.mappingGraph.bind(Object(l.a)(r)),r.onSelectedNodeListChange=r.onSelectedNodeListChange.bind(Object(l.a)(r)),r.onShowModeChange=r.onShowModeChange.bind(Object(l.a)(r)),r.state={showMode:1},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.renderD3()}},{key:"componentDidUpdate",value:function(e,t){z(e.selectedNodeIdList,this.props.selectedNodeIdList)?e.showMode!==this.props.showMode&&this.renderD3():this.renderD3(),z(e.highlightNodeIdList,this.props.highlightNodeIdList)||this.updateHighlightStatus()}},{key:"onSelectedNodeListChange",value:function(e,t){this.props.onChangeHighLightNodeIdList(e,t)}},{key:"test",value:function(){var e=tt.scaleSqrt().domain([0,1e5]).range([.2,24]),t=tt.scaleOrdinal(tt.schemeCategory20b),n=tt.scaleLinear().range([40,260]),r=tt.scaleLinear().range([40,260]);tt.csv("cities.csv",(function(a){var o=a.sort((function(e,t){return tt.descending(+e[2015],+t[2015])})).map((function(e,t){return[+e.Longitude,+e.Latitude,e["Urban Agglomeration"],+e[2015],+e["Country Code"]]})).slice(0,800),i=tt.select("#chart").append("canvas").attr("width",300).attr("height",300),s=new rt.tSNE({dim:2,perplexity:30}),c=o.map((function(e){return o.map((function(t){return tt.geoDistance(e,t)}))}));s.initDataDist(c);tt.forceSimulation(o.map((function(e){return e.x=150,e.y=150,e}))).alphaDecay(.005).alpha(.1).force("tsne",(function(e){s.step();var t=s.getSolution();n.domain(tt.extent(t.map((function(e){return e[0]})))),r.domain(tt.extent(t.map((function(e){return e[1]})))),o.forEach((function(a,o){a.x+=e*(n(t[o][0])-a.x),a.y+=e*(r(t[o][1])-a.y)}))})).force("collide",tt.forceCollide().radius((function(t){return 1.5+e(t[3])}))).on("tick",(function(){var n=o.map((function(n,r){return{x:n.x,y:n.y,r:e(n[3]),color:t(n[4])}}));!function(e,t){var n=e.node().getContext("2d");n.clearRect(0,0,300,300);for(var r=0,a=t.length;r<a;++r){var o=t[r];n.beginPath(),n.moveTo(o.x,o.y),n.arc(o.x,o.y,o.r,0,2*Math.PI),n.lineWidth=.5,n.fillStyle=o.color,n.fill()}}(i,n)}))}))}},{key:"mappingGraph",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===e?e=this.point_array:this.point_array=e,null===t?t=this.additional_info:this.additional_info=t,null===n?n=this.model:this.model=n;var r=this.props.showMode;if(tt.select("#ScatterPlot_sub_"+this.props.id).remove(),!(e.length<=0)){var a=e[0].data.Spd_node_info.length,o=e.length,i={radius:3.5,showlabel:!0,width:this.props.width,height:this.props.height};o>=100&&(i={radius:3.5,showlabel:!1,width:this.props.width,height:this.props.height});var s=tt.select("#TopSVGChart_ScatterPlot_"+this.props.id),c=i.width,l=i.height,u=s.append("g").attr("id","ScatterPlot_sub_"+this.props.id),h=u.append("g");h.attr("width",c).attr("height",l),u.append("rect").attr("x",0).attr("y",0).attr("width",c).attr("height",l).attr("fill","white").attr("stroke","#bbb").attr("stroke-width",2).attr("fill-opacity",.1).attr("stroke-opacity",.5),u.append("text").attr("x",c/2).attr("y",-2).attr("text-anchor","middle").text(this.props.name).on("mousemove",Y).on("mouseout",X);this.props.name;var d="clip_"+this.props.id,f="url(#"+d+")";h.append("defs").append("clipPath").attr("id",d).append("rect").attr("x",0).attr("y",0).attr("width",c).attr("height",l),h.attr("clip-path",f);tt.transition().duration(1e3).ease(tt.easeLinear);var p=h.selectAll("g.nodes").data(e,(function(e,t){return""+e.data.Data_id})),g=p.enter().append("g").attr("class","nodes"),v=p.merge(g).attr("opacity",.9);p.exit().remove();var _=3,m=.3;if(3===r||4===r);else{var y=g.append("circle").attr("class","proj_outer_circle"),x=p.select("circle.proj_outer_circle"),b=y.merge(x);b.attr("r",(function(e){return 2*_})).attr("fill",(function(e){return e.data.Color[4]}))}var w,C,E,S,M=4.5;if(1===r)!function(){w=[{index:0,value:1/3},{index:1,value:1/3},{index:2,value:1/3}],C=tt.pie().startAngle(-60/180*Math.PI).endAngle((2-60/180)*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index})),E=C(w);for(var e=[],t=function(t){var n=g.append("path").attr("class","arc_"+t),r=p.select("path.arc_"+t),a=n.merge(r);a.style("fill",(function(e){return e.data.Color[t+1]})).attr("d",(function(e){return q(_)(E[t])})),e.push(a)},n=0;n<3;n++)t(n);S=tt.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index}));for(var r=[],a=2*_+2,o=function(e){var t=g.append("path").attr("class","arc_"+e),n=p.select("path.arc_"+e),o=t.merge(n);o.style("fill",(function(t){return 3===e?"#000":4===e?"#fff":void 0})).attr("d",(function(t){var n=[{index:0,value:t.data.GCN_Confidence},{index:1,value:1-t.data.GCN_Confidence}],r=S(n);return Z(a,1)(r[e-3])})),r.push(o)},i=3;i<5;i++)o(i)}();else 3===r?function(){var e=_*M/2,t=_*M,n=g.append("rect").attr("class","gnnrect"),r=p.select("rect.gnnrect");n.merge(r).attr("x",-e).attr("y",-t/2).attr("width",e).attr("height",t).attr("fill",(function(e){return e.data.Color[1]}));for(var o=function(n){var r=g.append("rect").attr("class","rect_"+n),a=p.select("rect.rect_"+n);r.merge(a).attr("x",(function(e){return 0})).attr("y",(function(e){for(var r=0,a=0;a<n;a++)r+=e.data.Spd_node_info[a];return r*t-t/2})).attr("width",(function(t){return e})).attr("height",(function(e){return t*e.data.Spd_node_info[n]})).attr("fill",(function(e){return A(n,2)}))},i=0;i<a;i++)o(i)}():4===r&&function(){var e=_*M/2,t=_*M,n=g.append("rect").attr("class","gnnrect"),r=p.select("rect.gnnrect");n.merge(r).attr("x",-e).attr("y",-t/2).attr("width",e).attr("height",t).attr("fill",(function(e){return e.data.Color[1]}));for(var a=function(n){var r=g.append("rect").attr("class","rect_"+n),a=p.select("rect.rect_"+n);r.merge(a).attr("x",(function(e){return 0})).attr("y",(function(e){return.2*n*t-t/2})).attr("width",(function(t){for(var r=0,a=0;a<5;a++){var o=t.data.Topkfs_nodes[a].anchor_similarity;r<o&&(r=o)}var i=t.data.Topkfs_nodes[n].anchor_similarity;return r>0&&(i/=r),e*i})).attr("height",(function(e){return.2*t})).attr("fill",(function(e){var t=e.data.Topkfs_nodes[n].anchor_label;return A(t,2)}))},o=0;o<5;o++)a(o)}();t.max_shortest_path_distance;var N=t.max_degree;if(1===r){var k=g.append("circle").attr("class","inner_circle"),L=p.select("circle.inner_circle"),I=k.merge(L);1===r?I.attr("r",(function(e){return _-m})).attr("fill",(function(e){return e.data.Color[0]})):I.attr("r",(function(e){return _-m})).attr("fill",(function(e){return e.data.Color[1]}))}else if(2===r){var P=g.append("polygon").attr("class","sp_polygon"),O=p.select("polygon.sp_polygon"),j=P.merge(O);j.attr("points",K).style("fill",(function(e){return e.data.Color[0]}))}var D=g.append("title");p.select("title").merge(D).text((function(e){return e.data.Data_id}));var G=40,T=tt.scaleLinear().range([G,c-G]),R=tt.scaleLinear().range([G,l-G]),F=2*_+2*m;2===r||(1===r?F+=3:3!==r&&4!==r||(F=_*M/3*2+m*M/3*2));tt.forceSimulation(e).alphaDecay(.005).alpha(.1).force("tsne",(function(t){n.step();var r=n.getSolution();T.domain(tt.extent(r.map((function(e){return e[0]})))),R.domain(tt.extent(r.map((function(e){return e[1]})))),e.forEach((function(e,n){e.x+=t*(T(r[n][0])-e.x),e.y+=t*(R(r[n][1])-e.y)}))})).force("collide",tt.forceCollide().radius((function(e){return F}))).on("tick",$);var V=this.props.renderLines,H=function(){B.items().classed("lasso_not_possible",!0).classed("lasso_unselected",!1).classed("lasso_selected",!1)},U=function(){B.possibleItems().classed("lasso_not_possible",!1).classed("lasso_unselected",!1).classed("lasso_possible",!0),B.notPossibleItems().classed("lasso_not_possible",!0).classed("lasso_unselected",!1).classed("lasso_possible",!1)},W=this.onSelectedNodeListChange,z=function(){B.items().classed("lasso_not_possible",!1).classed("lasso_possible",!1),B.selectedItems().classed("lasso_selected",!0);var e,t=B.selectedItems().data();B.notSelectedItems().data().forEach((function(e){e.selected=!1})),B.selectedItems().data().forEach((function(e){e.selected=!0})),0===t.length?(e=B.notSelectedItems().data(),B.notSelectedItems().classed("lasso_unselected",!1)):(e=t,B.notSelectedItems().classed("lasso_unselected",!0)),console.log(e);var n=e.map((function(e){return e.data.Data_id})),r=t.map((function(e){return e.data.Data_id}));W(n,r)},B=nt.default().closePathSelect(!0).closePathDistance(100).items(v).targetArea(s).on("start",H).on("draw",U).on("end",z);s.call(B)}function J(){tt.select("#tooltip_proj").style("opacity",0)}function Y(){var e,t=this;function n(e){for(var t="",n=0;n<e.length;n++){var r="M";n>0&&(r="L"),t=t+r+e[n][0]+" "+e[n][1]+" "}return t}e=[tt.event.pageX,tt.event.pageY];var a=100,o=100;1===r?(a=100,o=100):2===r?(a=130,o=100):3!==r&&4!==r||(a=70,o=40);var s=tt.select("#tooltip_proj").style("opacity",.8).style("top",e[1]-o+"px").style("left",e[0]+10+"px");s.selectAll("*").remove();var c,l,u,h,d=s.append("svg").attr("width",a).attr("height",o),f=i.radius,v=f-.3,_=d;if(1===r)!function(){m=_.append("g").attr("width",100).attr("height",70).attr("transform","translate(0,0)"),c=[{index:0,value:1/3},{index:1,value:1/3},{index:2,value:1/3}],l=tt.pie().startAngle(-60/180*Math.PI).endAngle((2-60/180)*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index})),u=l(c);t.refresh_number=t.refresh_number+1;var e=m.selectAll("g.legend_pie").data([t.refresh_number],(function(e){return e}));e.exit().remove();var r=e.enter().append("g").attr("class","legend_pie").attr("transform","translate(30,50)"),a=["#1f77b4","#ff7f0e","#2ca02c","#d62728"];r.append("circle").attr("class","inner_circle").attr("r",2*v).attr("fill",(function(e){return a[0]})).attr("stroke","white");for(var o=[{text:"GT","text-anchor":"begin","dominant-baseline":"central",y_offset:1},{text:"P1","text-anchor":"begin","dominant-baseline":"central",y_offset:-7.5},{text:"P2","text-anchor":"begin","dominant-baseline":"central",y_offset:0},{text:"P3","text-anchor":"begin","dominant-baseline":"central",y_offset:19},{text:"Conf","text-anchor":"begin","dominant-baseline":"central",y_offset:0}],i=function(e){var t=r.append("path").attr("class","arc_"+e),n=r.select("path.arc_"+e);t.merge(n).style("fill",(function(t){return a[e+1]})).attr("d",function(e){return tt.arc().innerRadius(e).outerRadius(2*e)}(2*f)(u[e]))},s=0;s<3;s++)i(s);h=tt.pie().startAngle(0*Math.PI).endAngle(2*Math.PI).value((function(e){return e.value})).sort((function(e,t){return e.index<t.index}));for(var d=[],p=2*f+2,g=function(e){var t=r.append("path").attr("class","arc_"+e),a=r.select("path.arc_"+e),i=t.merge(a);i.style("fill",(function(t){return 3===e?"#000":4===e?"#fff":void 0})).attr("d",(function(t){var n=h([{index:0,value:.66},{index:1,value:1-.66}]);return Z(2*p,2)(n[e-3])})),d.push(i);for(var s=0;s<3;s++){var c=[3*f*Math.sin(120*s/180*Math.PI),3*f*-Math.cos(120*s/180*Math.PI)],l=[3*f*Math.sin(120*s/180*Math.PI),9*f*-Math.cos(120*s/180*Math.PI)+o[s+1].y_offset];1===s&&(l=[9*f*Math.sin(120*s/180*Math.PI),9*f*-Math.cos(120*s/180*Math.PI)+o[s+1].y_offset]);var u=[9*f*Math.sin(60/180*Math.PI),9*f*-Math.cos(120*s/180*Math.PI)+o[s+1].y_offset];r.append("path").attr("stroke","#222").attr("stroke-width",1).attr("d",n([c,l,u])).attr("fill","none"),r.append("text").attr("x",u[0]).attr("y",u[1]).attr("text-anchor",o[s+1]["text-anchor"]).attr("dominant-baseline",o[s+1]["dominant-baseline"]).text(o[s+1].text)}var g=9*f*Math.sin(60/180*Math.PI),v=9*f*-Math.cos(60/180*Math.PI)+o[0].y_offset;r.append("line").attr("stroke","#222").attr("stroke-width",1).attr("x1",0).attr("y1",0).attr("x2",g).attr("y2",v),r.append("text").attr("x",g).attr("y",v).attr("text-anchor",o[0]["text-anchor"]).attr("dominant-baseline",o[0]["dominant-baseline"]).text(o[0].text),g=7*f*Math.sin(.5*Math.PI),v=7*f*-Math.cos(.5*Math.PI)+o[4].y_offset,r.append("line").attr("stroke","#222").attr("stroke-width",1).attr("x1",2*p+1).attr("y1",0).attr("x2",g).attr("y2",v),r.append("text").attr("x",g).attr("y",v).attr("text-anchor",o[4]["text-anchor"]).attr("dominant-baseline",o[4]["dominant-baseline"]).text(o[4].text)},y=3;y<5;y++)g(y)}();else if(2===r){var m=_.append("g").attr("width",100).attr("height",70).attr("transform","translate(0,0)");this.refresh_number=this.refresh_number+1;var y=m.selectAll("g.legend_pie").data([this.refresh_number],(function(e){return e}));y.exit().remove();var x=y.enter().append("g").attr("class","legend_pie").attr("transform","translate(30,45)");x.append("circle").attr("class","proj_outer_circle").attr("r",2*f*2).attr("fill",(function(e){return"white"}));for(var b=[{text:"DEG","text-anchor":"begin","dominant-baseline":"central",y_offset:16},{text:"CGTNGT","text-anchor":"begin","dominant-baseline":"central",y_offset:16},{text:"CGTNPT","text-anchor":"begin","dominant-baseline":"central",y_offset:0},{text:"CPTNGT","text-anchor":"begin","dominant-baseline":"central",y_offset:18},{text:"CPTNPT","text-anchor":"begin","dominant-baseline":"central",y_offset:-22}],w=[.8,.8,.8,.8,.8],C=[],E=2*f*2,S=w.length,M=0;M<S;M++)C.push([w[M]*E*Math.sin(M/S*Math.PI*2),-w[M]*E*Math.cos(M/S*Math.PI*2)]);for(var N="",k=0;k<C.length;k++)N=N+C[k][0]+","+C[k][1]+" ";var L=N;x.append("polygon").attr("class","sp_polygon").attr("points",L).style("fill","#1f77b4");for(var I=0;I<5;I++){var P=[3*f*Math.sin(72*I/180*Math.PI),3*f*-Math.cos(72*I/180*Math.PI)],O=[3*f*Math.sin(72*I/180*Math.PI),9*f*-Math.cos(72*I/180*Math.PI)+b[I].y_offset],j=[9*f*Math.sin(.4*Math.PI),9*f*-Math.cos(72*I/180*Math.PI)+b[I].y_offset];x.append("path").attr("stroke","#222").attr("stroke-width",1).attr("d",n([P,O,j])).attr("fill","none"),x.append("text").attr("x",j[0]).attr("y",j[1]).attr("text-anchor",b[I]["text-anchor"]).attr("dominant-baseline",b[I]["dominant-baseline"]).text(b[I].text)}}else if(3===r){!function(){m=_.append("g").attr("width",100).attr("height",70).attr("transform","translate(0,0)");t.refresh_number=t.refresh_number+1;var e=m.selectAll("g.legend_pie").data([t.refresh_number],(function(e){return e}));e.exit().remove();var r=e.enter().append("g").attr("class","legend_pie").attr("transform","translate(20,30)"),a=1.5*f*2,o=3*f*2;r.append("rect").attr("class","gnnrect").attr("x",-a).attr("y",-o/2).attr("width",a).attr("height",o).attr("fill","#1f77b4");for(var i=[0,.7,.2,.1],s=function(e){var t=g.append("rect").attr("class","rect_"+e),n=p.select("rect.rect_"+e);t.merge(n);r.append("rect").attr("class","rect_"+e).attr("x",(function(e){return 0})).attr("y",(function(t){for(var n=0,r=0;r<e;r++)n+=i[r];return n*o-o/2})).attr("width",(function(e){return a})).attr("height",(function(t){return o*i[e]})).attr("fill",(function(t){return A(e,2)}))},c=0;c<4;c++)s(c);for(var l=[{text:"P1","text-anchor":"begin","dominant-baseline":"central",y_offset:0},{text:"SPD","text-anchor":"begin","dominant-baseline":"central",y_offset:0}],u=0;u<2;u++){var h=[],d=[],v=[];0===u?(h=[-.5*a,0],d=[-.5*a,-o],v=[1.5*a,-o]):1===u&&(h=[.5*a,0],d=[.5*a,0],v=[1.5*a,0]),r.append("path").attr("stroke","#222").attr("stroke-width",1).attr("d",n([h,d,v])).attr("fill","none"),r.append("text").attr("x",v[0]).attr("y",v[1]).attr("text-anchor",l[u]["text-anchor"]).attr("dominant-baseline",l[u]["dominant-baseline"]).text(l[u].text)}}()}else if(4===r){!function(){m=_.append("g").attr("width",100).attr("height",70).attr("transform","translate(0,0)");t.refresh_number=t.refresh_number+1;var e=m.selectAll("g.legend_pie").data([t.refresh_number],(function(e){return e}));e.exit().remove();var r=e.enter().append("g").attr("class","legend_pie").attr("transform","translate(20,30)"),a=1.5*f*2,o=3*f*2;r.append("rect").attr("class","gnnrect").attr("x",-a).attr("y",-o/2).attr("width",a).attr("height",o).attr("fill","#1f77b4");for(var i=[1,.9,.8,.7,.6],s=function(e){var t=g.append("rect").attr("class","rect_"+e),n=p.select("rect.rect_"+e);t.merge(n);r.append("rect").attr("class","rect_"+e).attr("x",(function(e){return 0})).attr("y",(function(t){return.2*e*o-o/2})).attr("width",(function(t){return a*i[e]})).attr("height",(function(e){return.2*o})).attr("fill",(function(t){return A(e,2)}))},c=0;c<5;c++)s(c);for(var l=[{text:"P1","text-anchor":"begin","dominant-baseline":"central",y_offset:0},{text:"KFS","text-anchor":"begin","dominant-baseline":"central",y_offset:0}],u=0;u<2;u++){var h=[],d=[],v=[];0===u?(h=[-.5*a,0],d=[-.5*a,-o],v=[1.5*a,-o]):1===u&&(h=[.5*a,0],d=[.5*a,0],v=[1.5*a,0]),r.append("path").attr("stroke","#222").attr("stroke-width",1).attr("d",n([h,d,v])).attr("fill","none"),r.append("text").attr("x",v[0]).attr("y",v[1]).attr("text-anchor",l[u]["text-anchor"]).attr("dominant-baseline",l[u]["dominant-baseline"]).text(l[u].text)}}()}}function X(){J()}function q(e){return tt.arc().innerRadius(e).outerRadius(2*e)}function Z(e,t){return tt.arc().innerRadius(e).outerRadius(t+e)}function K(e){var t=[],n=e.data.Real_Degree;t.push(n/N),t.push(e.data.CN_consistency.cgt_ngt),t.push(e.data.CN_consistency.cgt_npt),t.push(e.data.CN_consistency.cpt_ngt),t.push(e.data.CN_consistency.cpt_npt);for(var r=[],a=2*_,o=t.length,i=0;i<o;i++)r.push([t[i]*a*Math.sin(i/o*Math.PI*2),-t[i]*a*Math.cos(i/o*Math.PI*2)]);for(var s="",c=0;c<r.length;c++)s=s+r[c][0]+","+r[c][1]+" ";return s}function $(){g.merge(p).attr("transform",(function(e){return"translate("+e.x+","+e.y+")"})),V()}}},{key:"updateHighlightStatus",value:function(){var e=this.props.highlightNodeIdList,t=tt.select("#ScatterPlot_sub_"+this.props.id).select("g").selectAll("g.nodes"),n=t.filter((function(t){return e.indexOf(t.data.Data_id)>=0?(t.selected=!0,!0):(t.selected=!1,!1)}));t.classed("lasso_not_possible",!1).classed("lasso_possible",!1).classed("lasso_selected",!1),e.length>0?t.classed("lasso_unselected",!0):t.classed("lasso_unselected",!1),n.classed("lasso_unselected",!1).classed("lasso_selected",!0)}},{key:"renderD3",value:function(){var e=this.props,t=e.filters,n=e.PCPJson,r=this.constructSelectedNodeList(t,n);if(!(r.length>=300)){for(var a=[],o=0,i=1,s={},c=0;c<r.length;c++){var l=r[c].Shortest_Path_Distance_to_Train_Nodes;"inf"!==l&&l>o&&(o=l);var u=r[c].Real_Degree;u>i&&(i=u)}var h=this.props.showMode;s.max_shortest_path_distance=o,s.max_degree=i;for(var d=0;d<r.length;d++){for(var f=[],p=0;p<r.length;p++)f.push(b(r[d],r[p],s,h));a.push(f)}var g=new rt.tSNE({dim:2,perplexity:30});g.initDataDist(a);var v=this.props.width/2,_=this.props.height/2,m=[];r.forEach((function(e,t){m.push({data:e,x:v,y:_})})),(0,this.mappingGraph)(m,s,g)}function y(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.pow(Math.abs(e[r]-t[r]),2);return n}function x(e){return[e.cgt_ngt,e.cgt_npt,e.cpt_ngt,e.cpt_npt]}function b(e,t,n,r){var a=0;if(1===r){for(var o=["Ground_Truth_Label","GCN_Prediction_Label","GCN(w/o_adj)_Prediction_Label","GCN(w/o_features)_Prediction_Label"],i=0;i<o.length;i++)e[o[i]]===t[o[i]]||(a+=1);var s=e.GCN_Confidence,c=t.GCN_Confidence;a+=Math.pow(Math.abs(s-c),2)}else if(2===r){for(var l=["Ground_Truth_Label"],u=0;u<l.length;u++)e[l[u]]===t[l[u]]||(a+=1);var h=e.Real_Degree,d=t.Real_Degree,f=n.max_degree;h/=f,d/=f,a+=Math.pow(Math.abs(h-d),2),a+=y(x(e.CN_consistency),x(t.CN_consistency))}else if(3===r){for(var p=["GCN_Prediction_Label"],g=0;g<p.length;g++)e[p[g]]===t[p[g]]||(a+=1);a+=y(e.Spd_node_info,t.Spd_node_info)}else if(4===r){for(var v=["GCN_Prediction_Label"],_=0;_<v.length;_++)e[v[_]]===t[v[_]]||(a+=1);a+=y(e.Topkfs_node_info,t.Topkfs_node_info)}return Math.sqrt(a)}}},{key:"constructSelectedNodeList",value:function(e,t){var n=t.PSData.slice(),r=[],a=Object.keys(e);return n.forEach((function(t,n){if(function(t){if(a.length>0){for(var n=0;n<a.length;n++)if(e[a[n]].indexOf(t[a[n]])<0)return!1;return!0}return!0}(t)){var o=t;r.push(o)}})),r}},{key:"onShowModeChange",value:function(e){this.setState({showMode:e})}},{key:"render",value:function(){var e=this.props,t=(e.selectedNodeIdList,e.x),n=e.y,a=e.width,o=e.height;return r.createElement("g",{id:"TopSVGChart_ScatterPlot_"+this.props.id,transform:"translate("+t+","+n+")",width:a,height:o})}}]),n}(r.Component)),ot=n(21),it=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).prevSelectedNodeIdList=[],r.thisSelectedNodeIdList=[],r.onChangeHighLightNodeIdList=r.onChangeHighLightNodeIdList.bind(Object(l.a)(r)),r.renderLines=r.renderLines.bind(Object(l.a)(r)),r.onChangeLines=r.onChangeLines.bind(Object(l.a)(r)),r.state={currentPage:1,highlightNodeIdList:[],enableLines:!0},r}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(e,t){z(this.prevSelectedNodeIdList,this.thisSelectedNodeIdList)||(this.props.changeSelectedNodeIdList(this.thisSelectedNodeIdList),this.prevSelectedNodeIdList=this.thisSelectedNodeIdList.slice(),this.setState({highlightNodeIdList:[]})),this.state.enableLines&&this.renderLines()}},{key:"constructSelectedNodeList",value:function(e,t){var n=t.PSData.slice(),r=[],a=Object.keys(e);return n.forEach((function(t,n){if(function(t){if(a.length>0){for(var n=0;n<a.length;n++)if(e[a[n]].indexOf(t[a[n]])<0)return!1;return!0}return!0}(t)){var o=t;r.push(o)}})),r}},{key:"constructDataJson",value:function(e,t){var n={};return e.forEach((function(e){var r=t[e.dataIndex];"one_hop_accuracy"===e.dataIndex&&(r=r.toFixed(4)),n[e.title]=r})),n}},{key:"renderLines",value:function(){var e,t,n,r,a,o,i,s,c,l=this;this.state.enableLines&&function(){for(var u=l.state.highlightNodeIdList,h=[],d=1;d<=4;d++)e=ot.select("#ScatterPlot_sub_"+d),t=e.select("g"),n=t.selectAll("g.nodes"),r={},n.data().forEach((function(e){u.indexOf(e.data.Data_id)>=0&&(r[e.data.Data_id]={x:e.x,y:e.y})})),h.push({id:d,point_array:r});for(var f=[],p=(l.props.height,(l.props.width-20-20)/4-10),g=!0,v=0;v<u.length;v++){for(var _=u[v],m=[],y=0;y<h.length;y++){if(!h[y].point_array[_]){g=!1;break}var x=20+y*(p+10),b=[h[y].point_array[_].x+x,h[y].point_array[_].y+20];m.push(b)}if(!g)break;f.push({node_id:_,coords:m})}if(g||(f=[]),a=ot.select("#connectionPath")){o=a.selectAll("path").data(f,(function(e){return e.node_id})),i=ot.line().curve(ot.curveNatural);s=o.enter().append("path"),c=s.merge(o),o.exit().remove(),c.attr("d",(function(e){return i(e.coords.slice())})).style("fill","none").style("stroke","#999").style("stroke-width",1.5).style("opacity",.5)}}()}},{key:"onChangeHighLightNodeIdList",value:function(e,t){this.props.changeSelectedNodeIdList(e.slice()),this.setState({highlightNodeIdList:t.slice()}),this.renderLines()}},{key:"onChangeLines",value:function(e){this.setState({enableLines:e})}},{key:"render",value:function(){var e,t,n=this,a=this.props,o=a.filters,i=a.PCPJson;a.changeSelectedNodeIdList,a.showSource;i.success?(t=this.constructSelectedNodeList(o,i),e=t.map((function(e){return e.Data_id}))):(t=[],e=[]),this.thisSelectedNodeIdList=e;var s=this.props.height-62-20,c=(this.props.width-20-20)/4-10;this.props.changePSSelectedNodes(t.length);var l=this.onChangeLines;return e.length>0&&e.length<300?r.createElement("div",{style:{width:"100%",height:this.props.height-10+"px",overflowX:"scroll"}},r.createElement("div",{className:"ViewTitle"},"Projection View",r.createElement("div",{style:{float:"right"}},"Links: ",r.createElement(xe.a,{checked:this.state.enableLines,onChange:l}),"\xa0\xa0\xa0\xa0 #Nodes: ",r.createElement(w.a,null,U(this.state.highlightNodeIdList.length,e.length)))),r.createElement("div",{className:"ViewBox"},r.createElement("svg",{style:{height:this.props.height-62+10+"px",width:this.props.width+"px"},id:"TopSVGChart_ScatterPlot",xmlns:"http://www.w3.org/2000/svg"},this.state.enableLines?r.createElement("g",{key:"c1",id:"connectionPath"}):r.createElement("g",{key:"c2",id:"connectionPath-Null"}),[[1,"GT + 3PT"],[2,"DEG + CN"],[3,"P1 + SPD"],[4,"P1 + KFS"]].map((function(t){return r.createElement(at,Object.assign({key:t[0],id:t[0],showMode:t[0]},n.props,{x:20+(t[0]-1)*(c+10),y:20,height:s,width:c,name:t[1],selectedNodeIdList:e,highlightNodeIdList:n.state.highlightNodeIdList,onChangeHighLightNodeIdList:n.onChangeHighLightNodeIdList,renderLines:n.renderLines}))}))))):r.createElement("div",{style:{width:"100%",height:this.props.height-10+"px",overflowX:"hidden"}},r.createElement("div",{className:"ViewTitle"},"Projection View "))}}]),n}(r.Component),st=Object(Y.b)((function(e){return{filters:e.filters,refreshnumber:e.refreshnumber,showSource:e.showSource,select_inspect_node:e.select_inspect_node,PCPJson:e.PSJson}}),(function(e){return{changeSelectedNodeIdList:function(t){return e(function(e){return{type:"SELECTED_NODE_ID_LIST_CHANGE",selectedNodeIdList:e}}(t))},changeShowSource:function(t){return e(Z(t))},changePSSelectedNodes:function(t){return e(function(e){return{type:"PSSELECTEDNODES_CHANGE",PSSelectedNodes:e}}(t))}}}))(it),ct=(n(275),n(267)),lt=n(138),ut=n.n(lt),ht=(ct.a.TabPane,n(21),b.a.Option,function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).PCPViewRef=void 0,a.GraphViewRef=void 0,a.FeatureMatrixViewRef=void 0,a.ControlPanelRef=void 0,a.ProjectionViewRef=void 0,a.onShowModeChange=a.onShowModeChange.bind(Object(l.a)(a)),a.onExplainNodeChange=a.onExplainNodeChange.bind(Object(l.a)(a)),a.onResizeStop=a.onResizeStop.bind(Object(l.a)(a)),a.getLayoutConfigWithName=a.getLayoutConfigWithName.bind(Object(l.a)(a)),a.getCurrentLayoutConfig=a.getCurrentLayoutConfig.bind(Object(l.a)(a)),a.onResize=a.onResize.bind(Object(l.a)(a)),a.PCPViewRef=r.createRef(),a.GraphViewRef=r.createRef(),a.FeatureMatrixViewRef=r.createRef(),a.ControlPanelRef=r.createRef(),a.ProjectionViewRef=r.createRef(),a.state={graph_object:{model:-1,graph:-1},show_mode:1,explained_node:0,layout_config:null,screenWidth:0,screenHeight:0},a}return Object(c.a)(n,[{key:"componentWillMount",value:function(){}},{key:"onResize",value:function(){this.setState({screenHeight:window.innerHeight,screenWidth:window.innerWidth})}},{key:"componentDidMount",value:function(){this.setState({layout_config:this.getWholeLayoutConfig(),screenHeight:window.innerHeight,screenWidth:window.innerWidth})}},{key:"shouldComponentUpdate",value:function(e,t){return!0}},{key:"componentWillUpdate",value:function(e,t){}},{key:"getgraphdata",value:function(){var e=Object(_.a)(v.a.mark((function e(t,n,r,a){var o;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te(t,n,r,a);case 2:!0===(o=e.sent).success&&this.setState({graph_object:o.graph_obj});case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getGraphBundledData",value:function(){var e=Object(_.a)(v.a.mark((function e(t){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe(t);case 2:!0===(n=e.sent).success&&this.setState({graph_object:n.graph_obj});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getLayoutConfigWithName",value:function(e){var t=0,n=0;return"PCPView"===e?this.PCPViewRef&&(t=this.PCPViewRef.current.offsetWidth,n=this.PCPViewRef.current.offsetHeight):"GraphView"===e?this.GraphViewRef&&(t=this.GraphViewRef.current.offsetWidth,n=this.GraphViewRef.current.offsetHeight):"FeatureMatrixView"===e?this.FeatureMatrixViewRef&&(t=this.FeatureMatrixViewRef.current.offsetWidth,n=this.FeatureMatrixViewRef.current.offsetHeight):"ProjectionView"===e?this.ProjectionViewRef&&(t=this.ProjectionViewRef.current.offsetWidth,n=this.ProjectionViewRef.current.offsetHeight):"ControlPanel"===e&&this.ControlPanelRef&&(t=this.ControlPanelRef.current.offsetWidth,n=this.ControlPanelRef.current.offsetHeight),{width:t,height:n}}},{key:"getWholeLayoutConfig",value:function(){var e=this,t={};return["PCPView","GraphView","FeatureMatrixView","ControlPanel","ProjectionView"].forEach((function(n){t[n]=e.getLayoutConfigWithName(n)})),t}},{key:"getCurrentLayoutConfig",value:function(e){var t=this.state.layout_config;return t&&t[e]?t[e]:null}},{key:"componentDidUpdate",value:function(e,t){e.dataset_id!==this.props.dataset_id&&(this.props.dataset_id&&this.props.dataset_id>=0?this.getGraphBundledData(this.props.dataset_id):this.setState({graph_object:{model:-1,graph:-1}})),e.contentHeight===this.props.contentHeight&&e.contentWidth===this.props.contentWidth||this.setState({layout_config:this.getWholeLayoutConfig()})}},{key:"onShowModeChange",value:function(e){this.setState({show_mode:e})}},{key:"onExplainNodeChange",value:function(e){this.setState({explained_node:e})}},{key:"onLayoutChange",value:function(e){console.log("Layout",e)}},{key:"onResizeStop",value:function(e){console.log("onResizeStop",e),console.log("Layout",this.getWholeLayoutConfig()),this.setState({layout_config:this.getWholeLayoutConfig()})}},{key:"render",value:function(){var e=this,t=this.state,n=t.graph_object,a=t.show_mode,o=t.explained_node,i=this.props.modelList,s=-1,c=-1;s=-1;var l=n.common;l&&(c=l.dataset_id);console.log("Dataruns graph_object",n);var u=function(e,t,n,a,o,i,s,c,l){return r.createElement(K,{graph_object:e,show_mode:t,explained_node:n,onExplainNodeChange:a,onShowModeChange:o,model:i,modelList:s,width:c,height:l})},h=function(e,t,n,a,o,i,s,c,l){return r.createElement(we,{graph_object:e,show_mode:t,explained_node:n,onExplainNodeChange:a,onShowModeChange:o,model:i,modelList:s,width:c,height:l})},d=function(e,t,n,a,o,i,s){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;return r.createElement(et,{graph_object:e,show_mode:t,explained_node:n,onExplainNodeChange:a,onShowModeChange:o,model:i,modelList:s,width:c,height:l})},f=(window.innerHeight,Math.floor(this.props.contentHeight/40)),p=f-3,g=Math.floor(f/2),v=f-g,_=[{i:"a",x:0,y:3,w:6,h:p,static:!0},{i:"b",x:6,y:g,w:11,h:v,static:!0},{i:"c",x:17,y:g,w:7,h:v,static:!0},{i:"d",x:0,y:0,w:6,h:3,static:!0},{i:"e",x:6,y:0,w:18,h:g,static:!0}],m=function(){var t=window.innerWidth;window.innerHeight;return r.createElement(ut.a,{className:"layout",layout:_,cols:24,rowHeight:30,width:t,onLayoutChange:e.onLayoutChange,onResizeStop:e.onResizeStop},r.createElement("div",{className:"PanelBox",key:"a",ref:e.PCPViewRef},c>=0&&e.getCurrentLayoutConfig("PCPView")?d(n,a,o,e.onExplainNodeChange,e.onShowModeChange,s,i,e.getCurrentLayoutConfig("PCPView").width,e.getCurrentLayoutConfig("PCPView").height):r.createElement("div",null)),r.createElement("div",{className:"PanelBox",key:"b",ref:e.GraphViewRef},c>=0&&e.getCurrentLayoutConfig("GraphView")?u(n,a,o,e.onExplainNodeChange,e.onShowModeChange,s,i,e.getCurrentLayoutConfig("GraphView").width,e.getCurrentLayoutConfig("GraphView").height):r.createElement("div",null)),r.createElement("div",{className:"PanelBox",key:"c",ref:e.FeatureMatrixViewRef},c>=0&&e.getCurrentLayoutConfig("FeatureMatrixView")?h(n,a,o,e.onExplainNodeChange,e.onShowModeChange,s,i,e.getCurrentLayoutConfig("FeatureMatrixView").width,e.getCurrentLayoutConfig("FeatureMatrixView").height):r.createElement("div",null)),r.createElement("div",{className:"PanelBox",key:"d",ref:e.ControlPanelRef},r.createElement(Ye,null)),r.createElement("div",{className:"PanelBox",key:"e",ref:e.ProjectionViewRef},c>=0&&e.getCurrentLayoutConfig("ProjectionView")?r.createElement(st,{height:e.getCurrentLayoutConfig("ProjectionView").height,width:e.getCurrentLayoutConfig("ProjectionView").width}):r.createElement("div",null)))};return m()}}]),n}(r.Component)),dt=Object(Y.b)((function(e){return{model:e.model,graph:e.graph,dataset_id:e.dataset_id,explain_id:e.explain_id,modelList:e.modelList}}),(function(e){return{}}))(ht),ft=d.a.Content,pt=d.a.Header,gt=function(e){Object(h.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).ContentRef=void 0,r.ContentRef=a.a.createRef(),r.onResize=r.onResize.bind(Object(l.a)(r)),r.state={contentWidth:0,contentHeight:0,screenHeight:0,screenWidth:0},r}return Object(c.a)(n,[{key:"getLayoutConfig",value:function(){var e=0,t=0;return this.ContentRef&&(e=this.ContentRef.current.offsetWidth,t=this.ContentRef.current.offsetHeight),{contentWidth:e,contentHeight:t}}},{key:"onResize",value:function(){this.updateLayoutState()}},{key:"updateLayoutState",value:function(){var e=this.getLayoutConfig(),t=e.contentWidth,n=e.contentHeight;this.setState({contentWidth:t,contentHeight:n,screenHeight:window.innerHeight,screenWidth:window.innerWidth})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize),this.updateLayoutState()}},{key:"componentDidUpdate",value:function(e,t){}},{key:"render",value:function(){var e=this.state,t=(e.screenWidth,e.screenHeight,e.contentWidth),n=e.contentHeight;return a.a.createElement(d.a,{className:"app"},a.a.createElement(pt,{className:"appHeader"},"GNNVis",a.a.createElement("img",{src:p.a,className:"appLogo","alt-text":"logo"})),a.a.createElement(ft,{className:"appContent"},a.a.createElement("div",{style:{height:"100%",width:"100%"},ref:this.ContentRef},t>0&&n>0?a.a.createElement(dt,{contentWidth:t,contentHeight:n}):a.a.createElement("div",null)),a.a.createElement("div",{id:"tooltip_proj"}),a.a.createElement("div",{id:"tooltip_matrix"})))}}]),n}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var vt=n(71),_t=n(20),mt={model:null,graph:null,dataset_id:null,explain_id:null,refreshnumber:0,showSource:!1,modelList:[],datasetList:[],explainList:[],graphList:[],filters:{},selectedNodeIdList:[],selectedMessagePassingNodeIdList:[],specificNodeIdList:[],select_inspect_node:0,prevGraphJson:null,matrixFilters:{refreshnumber:0},matrixRowFilters:{refreshnumber:0},InspectCategoryList:W,PSJson:{},PSSelectedNodes:0,extendedMode:1},yt=(n(262),n(263),Object(vt.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mt,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"MODEL_CHANGE":return Object(_t.a)({},e,{model:t.model});case"GRAPH_CHANGE":return Object(_t.a)({},e,{graph:t.graph});case"INIT_MODEL_LIST":return Object(_t.a)({},e,{modelList:t.modelList});case"DATASET_ID_CHANGE":return Object(_t.a)({},e,{dataset_id:t.dataset_id});case"EXPLAIN_METHOD_ID_CHANGE":return Object(_t.a)({},e,{explain_id:t.explain_id});case"INIT_DATASET_LIST":return Object(_t.a)({},e,{datasetList:t.datasetList});case"INIT_EXPLAIN_LIST":return Object(_t.a)({},e,{explainList:t.explainList});case"INIT_GRAPH_LIST":return Object(_t.a)({},e,{graphList:t.graphList});case"FILTERS_CHANGE":return Object(_t.a)({},e,{refreshnumber:e.refreshnumber+1,filters:t.filters});case"SELECTED_NODE_ID_LIST_CHANGE":return Object(_t.a)({},e,{selectedNodeIdList:t.selectedNodeIdList});case"SELECTED_MESSAGE_PASSING_NODE_ID_LIST_CHANGE":return Object(_t.a)({},e,{selectedMessagePassingNodeIdList:t.selectedMessagePassingNodeIdList});case"SHOW_SOURCE_CHANGE":return Object(_t.a)({},e,{showSource:t.showSource});case"SPECIFIC_NODE_ID_LIST_CHANGE":return Object(_t.a)({},e,{specificNodeIdList:t.specificNodeIdList});case"SELECT_INSPECT_NODE_CHANGE":return Object(_t.a)({},e,{select_inspect_node:t.select_inspect_node});case"CLEAR_ID_INFO":return Object(_t.a)({},e,{filters:{},selectedNodeIdList:[],selectedMessagePassingNodeIdList:[],specificNodeIdList:[],select_inspect_node:0});case"PREV_GRAPH_JSON_CHANGE":return Object(_t.a)({},e,{prevGraphJson:t.prevGraphJson});case"MATRIX_FILTERS_CHANGE":return Object(_t.a)({},e,{matrixFilters:t.matrixFilters});case"MATRIX_ROW_FILTERS_CHANGE":return Object(_t.a)({},e,{matrixRowFilters:t.matrixRowFilters});case"INSPECT_CATEGORY_LIST_CHANGE":return Object(_t.a)({},e,{InspectCategoryList:t.inspectCategoryList});case"PSJSON_CHANGE":return Object(_t.a)({},e,{PSJson:t.PSJson});case"PSSELECTEDNODES_CHANGE":return Object(_t.a)({},e,{PSSelectedNodes:t.PSSelectedNodes});case"EXTENDED_MODE_CHANGE":return Object(_t.a)({},e,{extendedMode:t.extendedMode});default:return e}})));i.a.render(a.a.createElement(Y.a,{store:yt},a.a.createElement(gt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[143,1,2]]]);
//# sourceMappingURL=main.ed3f9419.chunk.js.map